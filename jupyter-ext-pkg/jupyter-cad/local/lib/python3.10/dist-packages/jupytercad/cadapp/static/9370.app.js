"use strict";(self.webpackChunk_JUPYTERLAB_CORE_OUTPUT=self.webpackChunk_JUPYTERLAB_CORE_OUTPUT||[]).push([[9370],{42938:(e,t,n)=>{n.d(t,{p:()=>i});var i,s=n(43044),o=n(39791),a=n(53968);!function(e){e.Model=class{constructor(e={}){var t,n;this.standaloneModel=!1,this._isDisposed=!1,this._selections=new o.ObservableMap,this._mimeType="text/plain",this._mimeTypeChanged=new a.Signal(this),this.standaloneModel=void 0===e.sharedModel,this.sharedModel=null!==(t=e.sharedModel)&&void 0!==t?t:new s.YFile,this._mimeType=null!==(n=e.mimeType)&&void 0!==n?n:"text/plain"}get mimeTypeChanged(){return this._mimeTypeChanged}get selections(){return this._selections}get mimeType(){return this._mimeType}set mimeType(e){const t=this.mimeType;t!==e&&(this._mimeType=e,this._mimeTypeChanged.emit({name:"mimeType",oldValue:t,newValue:e}))}get isDisposed(){return this._isDisposed}dispose(){this._isDisposed||(this._isDisposed=!0,this._selections.dispose(),this.standaloneModel&&this.sharedModel.dispose(),a.Signal.clearData(this))}}}(i||(i={}))},95274:(e,t,n)=>{n.d(t,{$C:()=>d});var i=n(23190),s=n(32322);const o=["cm-string","cm-overlay","cm-searching"],a=["CodeMirror-selectedtext"];class l{static search(e,t){if(!(t instanceof Node))return console.warn("Unable to search with HTMLSearchEngine the provided object.",t),Promise.resolve([]);e.global||(e=new RegExp(e.source,e.flags+"g"));const n=[],i=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,{acceptNode:n=>{let i=n.parentElement;for(;i!==t;){if(i.nodeName in l.UNSUPPORTED_ELEMENTS)return NodeFilter.FILTER_REJECT;i=i.parentElement}return e.test(n.textContent)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}});let s=null;for(;null!==(s=i.nextNode());){e.lastIndex=0;let t=null;for(;null!==(t=e.exec(s.textContent));)n.push({text:t[0],position:t.index,node:s})}return Promise.resolve(n)}}l.UNSUPPORTED_ELEMENTS={BASE:!0,HEAD:!0,LINK:!0,META:!0,STYLE:!0,TITLE:!0,BODY:!0,AREA:!0,AUDIO:!0,IMG:!0,MAP:!0,TRACK:!0,VIDEO:!0,APPLET:!0,EMBED:!0,IFRAME:!0,NOEMBED:!0,OBJECT:!0,PARAM:!0,PICTURE:!0,SOURCE:!0,CANVAS:!0,NOSCRIPT:!0,SCRIPT:!0,SVG:!0};class d extends s.X{constructor(){super(...arguments),this.isReadOnly=!0,this._matches=[],this._mutationObserver=new MutationObserver(this._onWidgetChanged.bind(this)),this._markNodes=new Array}static isApplicable(e){return e instanceof i.Widget}static createNew(e,t,n){return new d(e)}get currentMatchIndex(){return this._currentMatchIndex>=0?this._currentMatchIndex:null}get currentMatch(){var e;return null!==(e=this._matches[this._currentMatchIndex])&&void 0!==e?e:null}get matches(){return this._matches?this._matches.map((e=>Object.assign({},e))):this._matches}get matchesCount(){return this._matches.length}clearHighlight(){return this._currentMatchIndex>=0&&this._markNodes[this._currentMatchIndex].classList.remove(...a),this._currentMatchIndex=-1,Promise.resolve()}dispose(){this.isDisposed||(this.endQuery().catch((e=>{console.error("Failed to end search query.",e)})),super.dispose())}async highlightNext(e){var t;return null!==(t=this._highlightNext(!1,null==e||e))&&void 0!==t?t:void 0}async highlightPrevious(e){var t;return null!==(t=this._highlightNext(!0,null==e||e))&&void 0!==t?t:void 0}async replaceCurrentMatch(e,t){return Promise.resolve(!1)}async replaceAllMatches(e){return Promise.resolve(!1)}async startQuery(e,t={}){if(await this.endQuery(),this._query=e,null===e)return Promise.resolve();const n=await l.search(e,this.widget.node);let i=0;for(;i<n.length;){let e=n[i].node,t=e.parentNode,s=[n[i]];for(;++i<n.length&&n[i].node===e;)s.unshift(n[i]);const a=s.map((n=>{const i=document.createElement("mark");i.classList.add(...o),i.textContent=n.text;const s=e.splitText(n.position);return s.textContent=s.textContent.slice(n.text.length),t.insertBefore(i,s),i}));for(let e=a.length-1;e>=0;e--)this._markNodes.push(a[e])}this._mutationObserver.observe(this.widget.node,{attributes:!1,characterData:!0,childList:!0,subtree:!0}),this._matches=n}async endQuery(){this._mutationObserver.disconnect(),this._markNodes.forEach((e=>{const t=e.parentNode;t.replaceChild(document.createTextNode(e.textContent),e),t.normalize()})),this._markNodes=[],this._matches=[],this._currentMatchIndex=-1}_highlightNext(e,t){if(0===this._matches.length)return null;if(-1===this._currentMatchIndex?this._currentMatchIndex=e?this.matches.length-1:0:(this._markNodes[this._currentMatchIndex].classList.remove(...a),this._currentMatchIndex=e?this._currentMatchIndex-1:this._currentMatchIndex+1,t&&(this._currentMatchIndex<0||this._currentMatchIndex>=this._matches.length)&&(this._currentMatchIndex=(this._currentMatchIndex+this._matches.length)%this._matches.length)),this._currentMatchIndex>=0&&this._currentMatchIndex<this._matches.length){const t=this._markNodes[this._currentMatchIndex];return t.classList.add(...a),function(e){const t=e.getBoundingClientRect();return t.top>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.left>=0&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}(t)||t.scrollIntoView(e),t.focus(),this._matches[this._currentMatchIndex]}return this._currentMatchIndex=-1,null}async _onWidgetChanged(e,t){this._currentMatchIndex=-1,await this.startQuery(this._query),this._stateChanged.emit()}}},32322:(e,t,n)=>{n.d(t,{X:()=>s});var i=n(53968);class s{constructor(e){this.widget=e,this._stateChanged=new i.Signal(this),this._filtersChanged=new i.Signal(this),this._disposed=!1}get stateChanged(){return this._stateChanged}get filtersChanged(){return this._filtersChanged}get currentMatchIndex(){return null}get isDisposed(){return this._disposed}get matchesCount(){return null}dispose(){this._disposed||(this._disposed=!0,i.Signal.clearData(this))}getInitialQuery(){return""}getFilters(){return{}}static preserveCase(e,t){return e.toUpperCase()===e?t.toUpperCase():e.toLowerCase()===e?t.toLowerCase():o(e)===e?o(t):t}}function o([e="",...t]){return e.toUpperCase()+""+t.join("").toLowerCase()}},63655:(e,t,n)=>{n.d(t,{Li:()=>a,S6:()=>l,VZ:()=>r,Xg:()=>o,ee:()=>d,hz:()=>s,pB:()=>i}),n(50558);const i=4,s=4;function o(e){return"execute_result"===e.output_type}function a(e){return"display_data"===e.output_type}function l(e){return"update_display_data"===e.output_type}function d(e){return"stream"===e.output_type}function r(e){return"error"===e.output_type}},39370:(e,t,n)=>{n.r(t),n.d(t,{CellList:()=>ce,CellTypeSwitcher:()=>ue,CommandEditStatus:()=>ye,ExecutionIndicator:()=>Ce,ExecutionIndicatorComponent:()=>me,INotebookTools:()=>vt,INotebookTracker:()=>ft,INotebookWidgetFactory:()=>_t,KernelError:()=>le,Notebook:()=>et,NotebookActions:()=>de,NotebookAdapter:()=>Se,NotebookModel:()=>ve,NotebookModelFactory:()=>fe,NotebookPanel:()=>nt,NotebookSearchProvider:()=>ht,NotebookToCFactory:()=>mt,NotebookToCModel:()=>pt,NotebookTools:()=>Ae,NotebookTracker:()=>wt,NotebookTrustStatus:()=>bt,NotebookViewModel:()=>Re,NotebookWidgetFactory:()=>xt,NotebookWindowedLayout:()=>Fe,RunningStatus:()=>ct,StaticNotebook:()=>Ze,ToolbarItems:()=>he,getIdForHeading:()=>Ct});var i=n(45494),s=n(53968),o=n(39791),a=n(39003);class l{constructor(e){var t;if(this._map=new o.ObservableMap,this._isDisposed=!1,this._stateChanged=new s.Signal(this),this._changed=new s.Signal(this),this._serialized=null,this._changeGuard=!1,this.contentFactory=null!==(t=e.contentFactory)&&void 0!==t?t:l.defaultContentFactory,e.values)for(const t of Object.keys(e.values))void 0!==e.values[t]&&this.set(t,e.values[t]);this._map.changed.connect(this._onMapChanged,this)}get stateChanged(){return this._stateChanged}get changed(){return this._changed}get keys(){return this._map.keys()}get length(){return this._map.keys().length}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,this._map.dispose(),s.Signal.clearData(this))}has(e){return this._map.has(e)}get(e){return this._map.get(e)}set(e,t){const n=this._createItem({value:t});this._map.set(e,n)}remove(e){this._map.delete(e)}clear(){this._map.values().forEach((e=>{e.dispose()})),this._map.clear()}fromJSON(e){this.clear(),Object.keys(e).forEach((t=>{void 0!==e[t]&&this.set(t,e[t])}))}toJSON(){const e={};for(const t of this._map.keys())e[t]=this._map.get(t).toJSON();return e}_createItem(e){const t=this.contentFactory.createAttachmentModel(e);return t.changed.connect(this._onGenericChange,this),t}_onMapChanged(e,t){this._serialized&&!this._changeGuard&&(this._changeGuard=!0,this._serialized.set(this.toJSON()),this._changeGuard=!1),this._changed.emit(t),this._stateChanged.emit(void 0)}_onGenericChange(){this._stateChanged.emit(void 0)}}!function(e){class t{createAttachmentModel(e){return new a.AttachmentModel(e)}}e.ContentFactory=t,e.defaultContentFactory=new t}(l||(l={}));class d{constructor(e){this._parent=e.parent||null,this._model=e.model}async resolveUrl(e){return this._parent&&!e.startsWith("attachment:")?this._parent.resolveUrl(e):e}async getDownloadUrl(e){if(this._parent&&!e.startsWith("attachment:"))return this._parent.getDownloadUrl(e);const t=e.slice(11),n=this._model.get(t);if(void 0===n)return e;const{data:i}=n,s=Object.keys(i)[0];if(void 0===s||-1===a.imageRendererFactory.mimeTypes.indexOf(s))throw new Error(`Cannot render unknown image mime type "${s}".`);return`data:${s};base64,${i[s]}`}isLocal(e){var t,n,i;return!(this._parent&&!e.startsWith("attachment:"))||null===(i=null===(n=(t=this._parent).isLocal)||void 0===n?void 0:n.call(t,e))||void 0===i||i}}var r=n(42938),h=n(54775),c=n(43044);const u=(0,c.createMutex)();function g(e){return"markdown"===e.type}class p extends r.p.Model{constructor(e={}){const{cell_type:t,sharedModel:n,...i}=e;super({sharedModel:null!=n?n:(0,c.createStandaloneCell)({cell_type:null!=t?t:"raw",id:e.id}),...i}),this.contentChanged=new s.Signal(this),this.stateChanged=new s.Signal(this),this._metadataChanged=new s.Signal(this),this._trusted=!1,this.standaloneModel=void 0===e.sharedModel,this.trusted=!!this.getMetadata("trusted")||!!e.trusted,this.sharedModel.changed.connect(this.onGenericChange,this),this.sharedModel.metadataChanged.connect(this._onMetadataChanged,this)}get metadataChanged(){return this._metadataChanged}get id(){return this.sharedModel.getId()}get metadata(){return this.sharedModel.metadata}get trusted(){return this._trusted}set trusted(e){const t=this.trusted;t!==e&&(this._trusted=e,this.onTrustedChanged(this,{newValue:e,oldValue:t}))}dispose(){this.isDisposed||(this.sharedModel.changed.disconnect(this.onGenericChange,this),this.sharedModel.metadataChanged.disconnect(this._onMetadataChanged,this),super.dispose())}onTrustedChanged(e,t){}deleteMetadata(e){return this.sharedModel.deleteMetadata(e)}getMetadata(e){return this.sharedModel.getMetadata(e)}setMetadata(e,t){void 0===t?this.sharedModel.deleteMetadata(e):this.sharedModel.setMetadata(e,t)}toJSON(){return this.sharedModel.toJSON()}onGenericChange(){this.contentChanged.emit(void 0)}_onMetadataChanged(e,t){this._metadataChanged.emit(t)}}class m extends p{constructor(e){var t;super(e);const n=null!==(t=e.contentFactory)&&void 0!==t?t:m.defaultContentFactory,i=this.sharedModel.getAttachments();this._attachments=n.createAttachmentsModel({values:i}),this._attachments.stateChanged.connect(this.onGenericChange,this),this._attachments.changed.connect(this._onAttachmentsChange,this),this.sharedModel.changed.connect(this._onSharedModelChanged,this)}get attachments(){return this._attachments}dispose(){this.isDisposed||(this._attachments.stateChanged.disconnect(this.onGenericChange,this),this._attachments.changed.disconnect(this._onAttachmentsChange,this),this._attachments.dispose(),this.sharedModel.changed.disconnect(this._onSharedModelChanged,this),super.dispose())}toJSON(){return super.toJSON()}_onAttachmentsChange(e,t){const n=this.sharedModel;u((()=>n.setAttachments(e.toJSON())))}_onSharedModelChanged(e,t){if(t.attachmentsChange){const e=this.sharedModel;u((()=>{var t;return this._attachments.fromJSON(null!==(t=e.getAttachments())&&void 0!==t?t:{})}))}}}!function(e){class t{createAttachmentsModel(e){return new l(e)}}e.ContentFactory=t,e.defaultContentFactory=new t}(m||(m={}));class C extends m{constructor(e={}){super({cell_type:"raw",...e})}get type(){return"raw"}toJSON(){return super.toJSON()}}class _ extends m{constructor(e={}){super({cell_type:"markdown",...e}),this.mimeType="text/x-ipythongfm"}get type(){return"markdown"}toJSON(){return super.toJSON()}}class v extends p{constructor(e={}){var t;super({cell_type:"code",...e}),this._executedCode="",this._isDirty=!1;const n=null!==(t=null==e?void 0:e.contentFactory)&&void 0!==t?t:v.defaultContentFactory,i=this.trusted,s=this.sharedModel.getOutputs();this._outputs=n.createOutputArea({trusted:i,values:s}),this.sharedModel.changed.connect(this._onSharedModelChanged,this),this._outputs.changed.connect(this.onGenericChange,this),this._outputs.changed.connect(this.onOutputsChange,this)}get type(){return"code"}get executionCount(){return this.sharedModel.execution_count||null}set executionCount(e){this.sharedModel.execution_count=e||null}get isDirty(){return this._isDirty}get outputs(){return this._outputs}clearExecution(){this.outputs.clear(),this.executionCount=null,this._setDirty(!1),this.sharedModel.deleteMetadata("execution"),this.trusted=!0}dispose(){this.isDisposed||(this.sharedModel.changed.disconnect(this._onSharedModelChanged,this),this._outputs.changed.disconnect(this.onGenericChange,this),this._outputs.changed.disconnect(this.onOutputsChange,this),this._outputs.dispose(),this._outputs=null,super.dispose())}onTrustedChanged(e,t){const n=t.newValue;if(this._outputs&&(this._outputs.trusted=n),n){const e=this.sharedModel,t=e.getMetadata();t.trusted=!0,e.setMetadata(t)}this.stateChanged.emit({name:"trusted",oldValue:t.oldValue,newValue:n})}toJSON(){return super.toJSON()}onOutputsChange(e,t){const n=this.sharedModel;u((()=>{switch(t.type){case"add":{const e=t.newValues.map((e=>e.toJSON()));n.updateOutputs(t.newIndex,t.newIndex,e);break}case"set":{const e=t.newValues.map((e=>e.toJSON()));n.updateOutputs(t.oldIndex,t.oldIndex+e.length,e);break}case"remove":n.updateOutputs(t.oldIndex,t.oldValues.length);break;default:throw new Error(`Invalid event type: ${t.type}`)}}))}_onSharedModelChanged(e,t){t.outputsChange&&u((()=>{this.outputs.clear(),e.getOutputs().forEach((e=>this._outputs.add(e)))})),t.executionCountChange&&(!t.executionCountChange.newValue||!this.isDirty&&t.executionCountChange.oldValue||this._setDirty(!1),this.stateChanged.emit({name:"executionCount",oldValue:t.executionCountChange.oldValue,newValue:t.executionCountChange.newValue})),t.sourceChange&&null!==this.executionCount&&this._setDirty(this._executedCode!==this.sharedModel.getSource().trim())}_setDirty(e){e||(this._executedCode=this.sharedModel.getSource().trim()),e!==this._isDirty&&(this._isDirty=e,this.stateChanged.emit({name:"isDirty",oldValue:!e,newValue:e}))}}!function(e){class t{createOutputArea(e){return new h.OutputAreaModel(e)}}e.ContentFactory=t,e.defaultContentFactory=new t}(v||(v={}));var f=n(29229),w=n(55455),y=n(19390),b=n(66514),x=n(77352),k=n(42122),S=n(50558),M=n(18246),I=n(68082),E=n(82361),A=n(23190),P=n(85403),N=n(93119),D=n.n(N);class T extends k.ReactWidget{constructor(){super(),this.addClass("jp-Collapser")}get collapsed(){return!1}render(){return N.createElement("div",{className:"jp-Collapser-child",onClick:e=>this.handleClick(e)})}}class O extends T{constructor(){super(),this.addClass("jp-InputCollapser")}get collapsed(){var e;const t=null===(e=this.parent)||void 0===e?void 0:e.parent;return!!t&&t.inputHidden}handleClick(e){var t;const n=null===(t=this.parent)||void 0===t?void 0:t.parent;n&&(n.inputHidden=!n.inputHidden),this.update()}}class L extends T{constructor(){super(),this.addClass("jp-OutputCollapser")}get collapsed(){var e;const t=null===(e=this.parent)||void 0===e?void 0:e.parent;return!!t&&t.outputHidden}handleClick(e){var t,n;const i=null===(t=this.parent)||void 0===t?void 0:t.parent;if(i&&(i.outputHidden=!i.outputHidden,i.outputHidden)){let e=null===(n=i.parent)||void 0===n?void 0:n.node;e&&P.TE.scrollIntoViewIfNeeded(e,i.node)}this.update()}}class H extends A.Widget{constructor(){super(),this.addClass("jp-CellHeader")}}class R extends A.Widget{constructor(){super(),this.addClass("jp-CellFooter")}}var F=n(71078);class B extends A.Widget{constructor(e){super(),this.addClass("jp-InputArea");const{contentFactory:t,editorOptions:n,model:i}=e;this.model=i,this.contentFactory=t;const s=this._prompt=t.createInputPrompt();s.addClass("jp-InputArea-prompt");const o=this._editor=new F.A({factory:t.editorFactory,model:i,editorOptions:n});o.addClass("jp-InputArea-editor");const a=this.layout=new A.PanelLayout;a.addWidget(s),a.addWidget(o)}get editorWidget(){return this._editor}get editor(){return this._editor.editor}get promptNode(){return this._prompt.node}get renderedInput(){return this._rendered}renderInput(e){const t=this.layout;this._rendered&&(this._rendered.parent=null),this._editor.hide(),this._rendered=e,t.addWidget(e)}showEditor(){this._rendered&&(this._rendered.parent=null),this._editor.show()}setPrompt(e){this._prompt.executionCount=e}dispose(){this.isDisposed||(this._prompt=null,this._editor=null,this._rendered=null,super.dispose())}}!function(e){e.ContentFactory=class{constructor(e){this._editor=e.editorFactory}get editorFactory(){return this._editor}createInputPrompt(){return new j}}}(B||(B={}));class j extends A.Widget{constructor(){super(),this._executionCount=null,this.addClass("jp-InputPrompt")}get executionCount(){return this._executionCount}set executionCount(e){this._executionCount=e,this.node.textContent=null===e?" ":`[${e||" "}]:`}}class W extends A.Widget{constructor(e){var t,n,i;const s=document.createElement("div");super({node:s});const o=(null!==(t=e.translator)&&void 0!==t?t:x.nullTranslator).load("jupyterlab"),a=document.createElement("div");a.className=null!==(n=e.promptClass)&&void 0!==n?n:"",s.insertAdjacentHTML("afterbegin",a.outerHTML),this._cell=document.createElement("div"),this._cell.classList.add("jp-Placeholder-content"),this._cell.title=o.__("Click to expand");const l=this._cell.appendChild(document.createElement("div"));l.classList.add("jp-Placeholder-contentContainer"),this._textContent=l.appendChild(document.createElement("span")),this._textContent.className="jp-PlaceholderText",this._textContent.innerText=null!==(i=e.text)&&void 0!==i?i:"",s.appendChild(this._cell),k.ellipsesIcon.element({container:l.appendChild(document.createElement("span")),className:"jp-MoreHorizIcon",elementPosition:"center",height:"auto",width:"32px"}),this.addClass("jp-Placeholder"),this._callback=e.callback}set text(e){this._textContent.innerText=e}get text(){return this._textContent.innerText}onAfterAttach(e){super.onAfterAttach(e),this.node.addEventListener("click",this._callback)}onBeforeDetach(e){this.node.removeEventListener("click",this._callback),super.onBeforeDetach(e)}}class V extends W{constructor(e){super({...e,promptClass:"jp-Placeholder-prompt jp-InputPrompt"}),this.addClass("jp-InputPlaceholder")}}class U extends W{constructor(e){super({...e,promptClass:"jp-Placeholder-prompt jp-OutputPrompt"}),this.addClass("jp-OutputPlaceholder")}}const J="jp-mod-resizedCell";class z extends A.Widget{constructor(e){super(),this.targetNode=e,this._isActive=!1,this._isDragging=!1,this.addClass("jp-CellResizeHandle"),this._resizer=new E.Throttler((e=>this._resize(e)),50)}dispose(){this._resizer.dispose(),super.dispose()}handleEvent(e){var t,n;switch(e.type){case"dblclick":null===(t=this.targetNode.parentNode)||void 0===t||t.childNodes.forEach((e=>{e.classList.remove(J)})),document.documentElement.style.setProperty("--jp-side-by-side-output-size","1fr"),this._isActive=!1;break;case"mousedown":this._isDragging=!0,this._isActive||(null===(n=this.targetNode.parentNode)||void 0===n||n.childNodes.forEach((e=>{e.classList.add(J)})),this._isActive=!0),window.addEventListener("mousemove",this),window.addEventListener("mouseup",this);break;case"mousemove":this._isActive&&this._isDragging&&this._resizer.invoke(e);break;case"mouseup":this._isDragging=!1,window.removeEventListener("mousemove",this),window.removeEventListener("mouseup",this)}}onAfterAttach(e){this.node.addEventListener("dblclick",this),this.node.addEventListener("mousedown",this),super.onAfterAttach(e)}onBeforeDetach(e){this.node.removeEventListener("dblclick",this),this.node.removeEventListener("mousedown",this),super.onBeforeDetach(e)}_resize(e){const{width:t,x:n}=this.targetNode.getBoundingClientRect(),i=t/(e.clientX-n)-1;if(0<i){const e=Math.max(Math.min(Math.abs(i),50),.05);document.documentElement.style.setProperty("--jp-side-by-side-output-size",`${e}fr`)}}}const q="jp-Cell-outputWrapper",$="jp-mod-dirty",K="jp-MarkdownHeadingCollapsed",Q="jp-collapseHeadingButton",G="jp-showHiddenCellsButton",Y="jp-mod-rendered",X="jp-mod-noOutputs",Z="application/x-jupyter-icontentsrich";class ee extends A.Widget{constructor(e){var t,n,i,o;super(),this.prompt="",this._displayChanged=new s.Signal(this),this._editorConfig={},this._inputHidden=!1,this._inViewportChanged=new s.Signal(this),this._readOnly=!1,this._ready=new S.PromiseDelegate,this._resizeDebouncer=new E.Debouncer((()=>{this._displayChanged.emit()}),0),this._syncCollapse=!1,this._syncEditable=!1,this.addClass("jp-Cell");const a=this._model=e.model;this.contentFactory=e.contentFactory,this.layout=null!==(t=e.layout)&&void 0!==t?t:new A.PanelLayout,this.translator=null!==(n=e.translator)&&void 0!==n?n:x.nullTranslator,this._editorConfig=null!==(i=e.editorConfig)&&void 0!==i?i:{},this._placeholder=!0,this._inViewport=!1,this.placeholder=null===(o=e.placeholder)||void 0===o||o,a.metadataChanged.connect(this.onMetadataChanged,this)}initializeState(){return this.loadCollapseState(),this.loadEditableState(),this}get displayChanged(){return this._displayChanged}get inViewport(){return this._inViewport}set inViewport(e){this._inViewport!==e&&(this._inViewport=e,this._inViewportChanged.emit(this._inViewport))}get inViewportChanged(){return this._inViewportChanged}get placeholder(){return this._placeholder}set placeholder(e){this._placeholder!==e&&!1===e&&(this.initializeDOM(),this._placeholder=e,this._ready.resolve())}get promptNode(){return this.placeholder?null:this._inputHidden?this._inputPlaceholder.node.firstElementChild:this._input.promptNode}get editorWidget(){var e,t;return null!==(t=null===(e=this._input)||void 0===e?void 0:e.editorWidget)&&void 0!==t?t:null}get editor(){var e,t;return null!==(t=null===(e=this._input)||void 0===e?void 0:e.editor)&&void 0!==t?t:null}get editorConfig(){return this._editorConfig}get headings(){return new Array}get model(){return this._model}get inputArea(){return this._input}get readOnly(){return this._readOnly}set readOnly(e){e!==this._readOnly&&(this._readOnly=e,this.syncEditable&&this.saveEditableState(),this.update())}isPlaceholder(){return this.placeholder}saveEditableState(){const{sharedModel:e}=this.model,t=e.getMetadata("editable");this.readOnly&&!1===t||!this.readOnly&&void 0===t||(this.readOnly?e.setMetadata("editable",!1):e.deleteMetadata("editable"))}loadEditableState(){this.readOnly=!1===this.model.sharedModel.getMetadata("editable")}get ready(){return this._ready.promise}setPrompt(e){var t;this.prompt=e,null===(t=this._input)||void 0===t||t.setPrompt(e)}get inputHidden(){return this._inputHidden}set inputHidden(e){var t;if(this._inputHidden!==e){if(!this.placeholder){const n=this._inputWrapper.layout;e?(this._input.parent=null,this._inputPlaceholder&&(this._inputPlaceholder.text=null===(t=this.model.sharedModel.getSource().split("\n"))||void 0===t?void 0:t[0]),n.addWidget(this._inputPlaceholder)):(this._inputPlaceholder.parent=null,n.addWidget(this._input))}this._inputHidden=e,this.syncCollapse&&this.saveCollapseState(),this.handleInputHidden(e)}}saveCollapseState(){const e={...this.model.getMetadata("jupyter")};this.inputHidden&&!0===e.source_hidden||!this.inputHidden&&void 0===e.source_hidden||(this.inputHidden?e.source_hidden=!0:delete e.source_hidden,0===Object.keys(e).length?this.model.deleteMetadata("jupyter"):this.model.setMetadata("jupyter",e))}loadCollapseState(){var e;const t=null!==(e=this.model.getMetadata("jupyter"))&&void 0!==e?e:{};this.inputHidden=!!t.source_hidden}handleInputHidden(e){}get syncCollapse(){return this._syncCollapse}set syncCollapse(e){this._syncCollapse!==e&&(this._syncCollapse=e,e&&this.loadCollapseState())}get syncEditable(){return this._syncEditable}set syncEditable(e){this._syncEditable!==e&&(this._syncEditable=e,e&&this.loadEditableState())}clone(){return new(0,this.constructor)({model:this.model,contentFactory:this.contentFactory,placeholder:!1,translator:this.translator})}dispose(){this.isDisposed||(this._resizeDebouncer.dispose(),this._input=null,this._model=null,this._inputWrapper=null,this._inputPlaceholder=null,super.dispose())}updateEditorConfig(e){this._editorConfig={...this._editorConfig,...e},this.editor&&this.editor.setOptions(this._editorConfig)}initializeDOM(){if(!this.placeholder)return;const e=this.contentFactory,t=this._model,n=e.createCellHeader();n.addClass("jp-Cell-header"),this.layout.addWidget(n);const i=this._inputWrapper=new A.Panel;i.addClass("jp-Cell-inputWrapper");const s=new O;s.addClass("jp-Cell-inputCollapser");const o=this._input=new B({model:t,contentFactory:e,editorOptions:this.getEditorOptions()});o.addClass("jp-Cell-inputArea"),i.addWidget(s),i.addWidget(o),this.layout.addWidget(i),this._inputPlaceholder=new V({callback:()=>{this.inputHidden=!this.inputHidden},text:o.model.sharedModel.getSource().split("\n")[0],translator:this.translator}),o.model.contentChanged.connect(((e,t)=>{var n;this._inputPlaceholder&&this.inputHidden&&(this._inputPlaceholder.text=null===(n=e.sharedModel.getSource().split("\n"))||void 0===n?void 0:n[0])})),this.inputHidden&&(o.parent=null,i.layout.addWidget(this._inputPlaceholder));const a=this.contentFactory.createCellFooter();a.addClass("jp-Cell-footer"),this.layout.addWidget(a)}getEditorOptions(){return{config:this.editorConfig}}onBeforeAttach(e){this.placeholder&&(this.placeholder=!1)}onAfterAttach(e){this.update()}onActivateRequest(e){var t;null===(t=this.editor)||void 0===t||t.focus()}onResize(e){this._resizeDebouncer.invoke()}onUpdateRequest(e){var t,n;this._model&&(null===(t=this.editor)||void 0===t?void 0:t.getOption("readOnly"))!==this._readOnly&&(null===(n=this.editor)||void 0===n||n.setOption("readOnly",this._readOnly))}onContentChanged(){var e;this.inputHidden&&this._inputPlaceholder&&(this._inputPlaceholder.text=null===(e=this.model.sharedModel.getSource().split("\n"))||void 0===e?void 0:e[0])}onMetadataChanged(e,t){switch(t.key){case"jupyter":this.syncCollapse&&this.loadCollapseState();break;case"editable":this.syncEditable&&this.loadEditableState()}}}!function(e){let t;!function(e){e[e.HTML=0]="HTML",e[e.Markdown=1]="Markdown"}(t=e.HeadingType||(e.HeadingType={})),e.ContentFactory=class{constructor(e){this._editorFactory=e.editorFactory}get editorFactory(){return this._editorFactory}createCellHeader(){return new H}createCellFooter(){return new R}createInputPrompt(){return new j}createOutputPrompt(){return new h.OutputPrompt}createStdin(e){return new h.Stdin(e)}}}(ee||(ee={}));class te extends A.PanelLayout{onBeforeAttach(e){let t=!0;const n=this.parent.node.firstElementChild;for(const i of this)n&&(i.node===n?t=!1:(I.MessageLoop.sendMessage(i,e),t?this.parent.node.insertBefore(i.node,n):this.parent.node.appendChild(i.node),this.parent.isHidden||i.setFlag(A.Widget.Flag.IsVisible),I.MessageLoop.sendMessage(i,A.Widget.Msg.AfterAttach)))}onAfterDetach(e){for(const t of this)!t.hasClass(q)&&t.node.isConnected&&(I.MessageLoop.sendMessage(t,A.Widget.Msg.BeforeDetach),this.parent.node.removeChild(t.node),I.MessageLoop.sendMessage(t,e))}}class ne extends ee{constructor(e){var t;super({layout:new te,...e,placeholder:!0}),this._headingsCache=null,this._outputHidden=!1,this._outputWrapper=null,this._outputPlaceholder=null,this._syncScrolled=!1,this.addClass("jp-CodeCell");const n=this.translator.load("jupyterlab"),i=this._rendermime=e.rendermime,s=this.contentFactory,o=this.model;this.maxNumberOutputs=e.maxNumberOutputs;const a=0===o.outputs.length?n.__("Code Cell Content"):n.__("Code Cell Content with Output");this.node.setAttribute("aria-label",a);const l=this._output=new h.OutputArea({model:this.model.outputs,rendermime:i,contentFactory:s,maxNumberOutputs:this.maxNumberOutputs,translator:this.translator,promptOverlay:!0,inputHistoryScope:e.inputHistoryScope});l.addClass("jp-Cell-outputArea"),l.toggleScrolling.connect((()=>{this.outputsScrolled=!this.outputsScrolled})),this.placeholder=null===(t=e.placeholder)||void 0===t||t,o.outputs.changed.connect(this.onOutputChanged,this),o.outputs.stateChanged.connect(this.onOutputChanged,this),o.stateChanged.connect(this.onStateChanged,this)}initializeDOM(){if(!this.placeholder)return;super.initializeDOM(),this.setPrompt(this.prompt);const e=this._outputWrapper=new A.Panel;e.addClass(q);const t=new L;t.addClass("jp-Cell-outputCollapser"),e.addWidget(t),0===this.model.outputs.length&&this.addClass(X),this._output.outputLengthChanged.connect(this._outputLengthHandler,this),e.addWidget(this._output);const n=this.layout;n.insertWidget(n.widgets.length-1,new z(this.node)),n.insertWidget(n.widgets.length-1,e),this.model.isDirty&&this.addClass($),this._outputPlaceholder=new U({callback:()=>{this.outputHidden=!this.outputHidden},text:this.getOutputPlaceholderText(),translator:this.translator});const i=e.layout;this.outputHidden&&(i.removeWidget(this._output),i.addWidget(this._outputPlaceholder),this.inputHidden&&!e.isHidden&&this._outputWrapper.hide());const s=this.translator.load("jupyterlab"),o=0===this.model.outputs.length?s.__("Code Cell Content"):s.__("Code Cell Content with Output");this.node.setAttribute("aria-label",o)}getOutputPlaceholderText(){var e;const t=this.model.outputs.get(0);if(!(null==t?void 0:t.data))return;const n=["text/html","image/svg+xml","application/pdf","text/markdown","text/plain","application/vnd.jupyter.stderr","application/vnd.jupyter.stdout","text"].find((e=>{const n=t.data[e];return"string"==(Array.isArray(n)?typeof n[0]:typeof n)})),i=t.data[null!=n?n:""];return void 0!==i?null===(e=Array.isArray(i)?i:null==i?void 0:i.split("\n"))||void 0===e?void 0:e.find((e=>""!==e)):void 0}initializeState(){return super.initializeState(),this.loadScrolledState(),this.setPrompt(`${this.model.executionCount||""}`),this}get headings(){if(!this._headingsCache){const e=[],t=this.model.outputs;for(let n=0;n<t.length;n++){const i=t.get(n);let s=null,o=null;Object.keys(i.data).forEach((e=>{!o&&y.kb(e)?o=e:!s&&b.FP(e)&&(s=e)})),s?e.push(...b.ok(this._rendermime.sanitizer.sanitize(i.data[s])).map((e=>({...e,outputIndex:n,type:ee.HeadingType.HTML})))):o&&e.push(...y.o3(i.data[o]).map((e=>({...e,outputIndex:n,type:ee.HeadingType.Markdown}))))}this._headingsCache=e}return[...this._headingsCache]}get outputArea(){return this._output}get outputHidden(){return this._outputHidden}set outputHidden(e){var t;if(this._outputHidden!==e){if(!this.placeholder){const n=this._outputWrapper.layout;e?(n.removeWidget(this._output),n.addWidget(this._outputPlaceholder),this.inputHidden&&!this._outputWrapper.isHidden&&this._outputWrapper.hide(),this._outputPlaceholder&&(this._outputPlaceholder.text=null!==(t=this.getOutputPlaceholderText())&&void 0!==t?t:"")):(this._outputWrapper.isHidden&&this._outputWrapper.show(),n.removeWidget(this._outputPlaceholder),n.addWidget(this._output))}this._outputHidden=e,this.syncCollapse&&this.saveCollapseState()}}saveCollapseState(){this.model.sharedModel.transact((()=>{super.saveCollapseState();const e=this.model.getMetadata("collapsed");this.outputHidden&&!0===e||!this.outputHidden&&void 0===e||(this.outputHidden?this.model.setMetadata("collapsed",!0):this.model.deleteMetadata("collapsed"))}),!1)}loadCollapseState(){super.loadCollapseState(),this.outputHidden=!!this.model.getMetadata("collapsed")}get outputsScrolled(){return this._outputsScrolled}set outputsScrolled(e){this.toggleClass("jp-mod-outputsScrolled",e),this._outputsScrolled=e,this.syncScrolled&&this.saveScrolledState()}saveScrolledState(){const e=this.model.getMetadata("scrolled");this.outputsScrolled&&!0===e||!this.outputsScrolled&&void 0===e||(this.outputsScrolled?this.model.setMetadata("scrolled",!0):this.model.deleteMetadata("scrolled"))}loadScrolledState(){"auto"===this.model.getMetadata("scrolled")?this.outputsScrolled=!1:this.outputsScrolled=!!this.model.getMetadata("scrolled")}get syncScrolled(){return this._syncScrolled}set syncScrolled(e){this._syncScrolled!==e&&(this._syncScrolled=e,e&&this.loadScrolledState())}handleInputHidden(e){this.placeholder||(!e&&this._outputWrapper.isHidden?this._outputWrapper.show():e&&!this._outputWrapper.isHidden&&this._outputHidden&&this._outputWrapper.hide())}clone(){return new(0,this.constructor)({model:this.model,contentFactory:this.contentFactory,rendermime:this._rendermime,placeholder:!1,translator:this.translator})}cloneOutputArea(){return new h.SimplifiedOutputArea({model:this.model.outputs,contentFactory:this.contentFactory,rendermime:this._rendermime})}dispose(){this.isDisposed||(this._output.outputLengthChanged.disconnect(this._outputLengthHandler,this),this._rendermime=null,this._output=null,this._outputWrapper=null,this._outputPlaceholder=null,super.dispose())}onStateChanged(e,t){switch(t.name){case"executionCount":this.setPrompt(`${e.executionCount||""}`);break;case"isDirty":e.isDirty?this.addClass($):this.removeClass($)}}onOutputChanged(){var e;this._headingsCache=null,this._outputPlaceholder&&this.outputHidden&&(this._outputPlaceholder.text=null!==(e=this.getOutputPlaceholderText())&&void 0!==e?e:"")}onMetadataChanged(e,t){switch(t.key){case"scrolled":this.syncScrolled&&this.loadScrolledState();break;case"collapsed":this.syncCollapse&&this.loadCollapseState()}super.onMetadataChanged(e,t)}_outputLengthHandler(e,t){const n=0===t;this.toggleClass(X,n);const i=this.translator.load("jupyterlab"),s=n?i.__("Code Cell Content"):i.__("Code Cell Content with Output");this.node.setAttribute("aria-label",s)}}!function(e){e.execute=async function(e,t,n){var i;const s=e.model,o=s.sharedModel.getSource();if(!o.trim()||!(null===(i=t.session)||void 0===i?void 0:i.kernel))return void s.sharedModel.transact((()=>{s.clearExecution()}),!1);const a={cellId:s.sharedModel.getId()};n={...s.metadata,...n,...a};const{recordTiming:l}=n;let d;s.sharedModel.transact((()=>{s.clearExecution(),e.outputHidden=!1}),!1),e.setPrompt("*"),s.trusted=!0;try{const i=h.OutputArea.execute(o,e.outputArea,t,n);if(l){const t=e=>{let t;switch(e.header.msg_type){case"status":t=`status.${e.content.execution_state}`;break;case"execute_input":t="execute_input";break;default:return!0}const n=e.header.date||(new Date).toISOString(),i=Object.assign({},s.getMetadata("execution"));return i[`iopub.${t}`]=n,s.setMetadata("execution",i),!0};e.outputArea.future.registerMessageHook(t)}else s.deleteMetadata("execution");d=e.outputArea.future;const a=await i;if(s.executionCount=a.content.execution_count,l){const e=Object.assign({},s.getMetadata("execution")),t=a.metadata.started;t&&(e["shell.execute_reply.started"]=t);const n=a.header.date;e["shell.execute_reply"]=n||(new Date).toISOString(),s.setMetadata("execution",e)}return a}catch(t){throw d&&!e.isDisposed&&e.outputArea.future===d&&e.setPrompt(""),t}}}(ne||(ne={}));class ie extends ee{handleEvent(e){switch(e.type){case"lm-dragover":this._evtDragOver(e);break;case"lm-drop":this._evtDrop(e)}}getEditorOptions(){var e,t;const n=null!==(e=super.getEditorOptions())&&void 0!==e?e:{};return n.extensions=[...null!==(t=n.extensions)&&void 0!==t?t:[],f.EditorView.domEventHandlers({dragenter:e=>{e.preventDefault()},dragover:e=>{e.preventDefault()},drop:e=>{this._evtNativeDrop(e)},paste:e=>{this._evtPaste(e)}})],n}onAfterAttach(e){super.onAfterAttach(e);const t=this.node;t.addEventListener("lm-dragover",this),t.addEventListener("lm-drop",this)}onBeforeDetach(e){const t=this.node;t.removeEventListener("lm-dragover",this),t.removeEventListener("lm-drop",this),super.onBeforeDetach(e)}_evtDragOver(e){(0,M.some)(a.imageRendererFactory.mimeTypes,(t=>!!e.mimeData.hasData(Z)&&e.mimeData.getData(Z).model.mimetype===t))&&(e.preventDefault(),e.stopPropagation(),e.dropAction=e.proposedAction)}_evtPaste(e){if(e.clipboardData){const t=e.clipboardData.items;for(let n=0;n<t.length;n++){if("text/plain"===t[n].type){if(n<t.length-1&&"file"===t[n+1].kind)continue;t[n].getAsString((e=>{var t,n;null===(n=(t=this.editor).replaceSelection)||void 0===n||n.call(t,e)}))}this._attachFiles(e.clipboardData.items)}}e.preventDefault()}_evtNativeDrop(e){e.dataTransfer&&this._attachFiles(e.dataTransfer.items),e.preventDefault()}_evtDrop(e){const t=e.mimeData.types().filter((t=>{if(t===Z){const t=e.mimeData.getData(Z);return-1!==a.imageRendererFactory.mimeTypes.indexOf(t.model.mimetype)}return-1!==a.imageRendererFactory.mimeTypes.indexOf(t)}));if(0!==t.length)if(e.preventDefault(),e.stopPropagation(),"none"!==e.proposedAction){e.dropAction="copy";for(const n of t)if(n===Z){const{model:t,withContent:n}=e.mimeData.getData(Z);if("file"===t.type){const e=this._generateURI(t.name);this.updateCellSourceWithAttachment(t.name,e),n().then((t=>{this.model.attachments.set(e,{[t.mimetype]:t.content})}))}}else{const t=this._generateURI();this.model.attachments.set(t,{[n]:e.mimeData.getData(n)}),this.updateCellSourceWithAttachment(t,t)}}else e.dropAction="none"}_attachFiles(e){for(let t=0;t<e.length;t++){const n=e[t];if("file"===n.kind){const e=n.getAsFile();e&&this._attachFile(e)}}}_attachFile(e){const t=new FileReader;t.onload=n=>{const{href:i,protocol:s}=w.URLExt.parse(t.result);if("data:"!==s)return;const o=/([\w+\/\+]+)?(?:;(charset=[\w\d-]*|base64))?,(.*)/.exec(i);if(!o||4!==o.length)return;const a=o[1],l={[a]:o[3]},d=this._generateURI(e.name);a.startsWith("image/")&&(this.model.attachments.set(d,l),this.updateCellSourceWithAttachment(e.name,d))},t.onerror=t=>{console.error(`Failed to attach ${e.name}`+t)},t.readAsDataURL(e)}_generateURI(e=""){const t=e.lastIndexOf(".");return-1!==t?S.UUID.uuid4().concat(e.substring(t)):S.UUID.uuid4()}}class se extends ie{constructor(e){var t,n,i,o;super({...e,placeholder:!0}),this._headingsCache=null,this._headingCollapsedChanged=new s.Signal(this),this._prevText="",this._rendered=!0,this._renderedChanged=new s.Signal(this),this._showEditorForReadOnlyMarkdown=!0,this.addClass("jp-MarkdownCell"),this.model.contentChanged.connect(this.onContentChanged,this);const a=this.translator.load("jupyterlab");this.node.setAttribute("aria-label",a.__("Markdown Cell Content")),this._rendermime=e.rendermime.clone({resolver:new d({parent:null!==(t=e.rendermime.resolver)&&void 0!==t?t:void 0,model:this.model.attachments})}),this._renderer=this._rendermime.createRenderer("text/markdown"),this._renderer.addClass("jp-MarkdownOutput"),this._headingCollapsed=null!==(n=this.model.getMetadata(K))&&void 0!==n&&n,this._showEditorForReadOnlyMarkdown=null!==(i=e.showEditorForReadOnlyMarkdown)&&void 0!==i?i:se.defaultShowEditorForReadOnlyMarkdown,this.placeholder=null===(o=e.placeholder)||void 0===o||o,this._monitor=new w.ActivityMonitor({signal:this.model.contentChanged,timeout:1e3}),this.ready.then((()=>{this.isDisposed||this._monitor.activityStopped.connect((()=>{this._rendered&&this.update()}),this)})).catch((e=>{console.error("Failed to be ready",e)}))}get headingInfo(){const e=this.headings;if(e.length>0){const{text:t,level:n}=e.reduce(((e,t)=>e.level<=t.level?e:t),e[0]);return{text:t,level:n}}return{text:"",level:-1}}get headings(){if(!this._headingsCache){const e=y.o3(this.model.sharedModel.getSource());this._headingsCache=e.map((e=>({...e,type:ee.HeadingType.Markdown})))}return[...this._headingsCache]}get headingCollapsed(){return this._headingCollapsed}set headingCollapsed(e){var t;if(this._headingCollapsed!==e){this._headingCollapsed=e,e?this.model.setMetadata(K,e):"undefined"!==this.model.getMetadata(K)&&this.model.deleteMetadata(K);const n=null===(t=this.inputArea)||void 0===t?void 0:t.promptNode.getElementsByClassName(Q)[0];n&&(e?n.classList.add("jp-mod-collapsed"):n.classList.remove("jp-mod-collapsed")),this.renderCollapseButtons(this._renderer),this._headingCollapsedChanged.emit(this._headingCollapsed)}}get numberChildNodes(){return this._numberChildNodes}set numberChildNodes(e){this._numberChildNodes=e,this.renderCollapseButtons(this._renderer)}get headingCollapsedChanged(){return this._headingCollapsedChanged}get rendered(){return this._rendered}set rendered(e){this.readOnly&&!1===this._showEditorForReadOnlyMarkdown&&(e=!0),e!==this._rendered&&(this._rendered=e,this._handleRendered().then((()=>{this._displayChanged.emit(),this._renderedChanged.emit(this._rendered)})).catch((e=>{console.error("Failed to render",e)})))}get renderedChanged(){return this._renderedChanged}get showEditorForReadOnly(){return this._showEditorForReadOnlyMarkdown}set showEditorForReadOnly(e){this._showEditorForReadOnlyMarkdown=e,!1===e&&(this.rendered=!0)}get renderer(){return this._renderer}dispose(){this.isDisposed||(this._monitor.dispose(),super.dispose())}initializeDOM(){this.placeholder&&(super.initializeDOM(),this.renderCollapseButtons(this._renderer),this._handleRendered().catch((e=>{console.error("Failed to render",e)})))}maybeCreateCollapseButton(){var e;const{level:t}=this.headingInfo;if(t>0&&0==(null===(e=this.inputArea)||void 0===e?void 0:e.promptNode.getElementsByClassName(Q).length)){let e=this.inputArea.promptNode.appendChild(document.createElement("button"));e.className=`jp-Button ${Q}`,e.setAttribute("data-heading-level",t.toString()),this._headingCollapsed?e.classList.add("jp-mod-collapsed"):e.classList.remove("jp-mod-collapsed"),e.onclick=e=>{this.headingCollapsed=!this.headingCollapsed}}}maybeCreateOrUpdateExpandButton(){const e=this.node.getElementsByClassName(G);let t=this.translator.load("jupyterlab")._n("%1 cell hidden","%1 cells hidden",this._numberChildNodes);if(this.headingCollapsed&&this._numberChildNodes>0&&0==e.length){const e=document.createElement("button");e.className=`jp-mod-minimal jp-Button ${G}`,k.addIcon.render(e);const n=document.createElement("div");n.textContent=t,e.appendChild(n),e.onclick=()=>{this.headingCollapsed=!1},this.node.appendChild(e)}if(this.headingCollapsed&&this._numberChildNodes>0&&1==e.length&&(e[0].childNodes[1].textContent=t),!(this.headingCollapsed&&this._numberChildNodes>0))for(const t of e)this.node.removeChild(t)}onContentChanged(){super.onContentChanged(),this._headingsCache=null}renderCollapseButtons(e){this.node.classList.toggle(K,this._headingCollapsed),this.maybeCreateCollapseButton(),this.maybeCreateOrUpdateExpandButton()}renderInput(e){this.addClass(Y),this.placeholder||this.isDisposed||(this.renderCollapseButtons(e),this.inputArea.renderInput(e))}showEditor(){if(this.removeClass(Y),!this.placeholder&&!this.isDisposed){this.inputArea.showEditor();let e=(this.model.sharedModel.getSource().match(/^#+/g)||[""])[0].length;e>0&&this.inputArea.editor.setCursorPosition({column:e+1,line:0})}}onUpdateRequest(e){this._handleRendered().catch((e=>{console.error("Failed to render",e)})),super.onUpdateRequest(e)}updateCellSourceWithAttachment(e,t){var n,i;const s=`![${e}](attachment:${null!=t?t:e})`;null===(i=null===(n=this.editor)||void 0===n?void 0:n.replaceSelection)||void 0===i||i.call(n,s)}async _handleRendered(){this._rendered?(await this._updateRenderedInput(),this._rendered&&this.renderInput(this._renderer)):this.showEditor()}_updateRenderedInput(){if(this.placeholder)return Promise.resolve();const e=this.model,t=e&&e.sharedModel.getSource()||"Type Markdown and LaTeX: $ α^2 $";if(t!==this._prevText){const e=new a.MimeModel({data:{"text/markdown":t}});return this._prevText=t,this._renderer.renderModel(e)}return Promise.resolve()}clone(){return new(0,this.constructor)({model:this.model,contentFactory:this.contentFactory,rendermime:this._rendermime,placeholder:!1,translator:this.translator})}}!function(e){e.defaultShowEditorForReadOnlyMarkdown=!0}(se||(se={}));class oe extends ee{constructor(e){super(e),this.addClass("jp-RawCell");const t=this.translator.load("jupyterlab");this.node.setAttribute("aria-label",t.__("Raw Cell Content"))}clone(){return new(0,this.constructor)({model:this.model,contentFactory:this.contentFactory,placeholder:!1,translator:this.translator})}}const ae="application/vnd.jupyter.cells";class le extends Error{constructor(e){const t=e,n=t.ename,i=t.evalue;super(`KernelReplyNotOK: ${n} ${i}`),this.errorName=n,this.errorValue=i,this.traceback=t.traceback,Object.setPrototypeOf(this,le.prototype)}}class de{static get executed(){return re.executed}static get executionScheduled(){return re.executionScheduled}static get selectionExecuted(){return re.selectionExecuted}constructor(){}}var re,he;!function(e){function t(e,t){if(!e.model||!e.activeCell)return;const n=re.getState(e),i=e.widgets.findIndex((t=>e.isSelectedOrActive(t)));let s=e.widgets.slice(i+1).findIndex((t=>!e.isSelectedOrActive(t)));s>=0?s+=i+1:s=e.model.cells.length,t>0?e.moveCell(i,s,s-i):e.moveCell(i,i+t,s-i),re.handleState(e,n,!0)}function n(e,t="below",n,i=!1){if(!e.model||!e.activeCell)return;const s=re.getState(e),o=e.model;e.mode="command";let a=0;const l=e.activeCellIndex;o.sharedModel.transact((()=>{switch(t){case"below":a=e.activeCellIndex+1;break;case"belowSelected":e.widgets.forEach(((t,n)=>{e.isSelectedOrActive(t)&&(a=n+1)}));break;case"above":a=e.activeCellIndex;break;case"replace":{const t=[];e.widgets.forEach(((n,i)=>{const s=!1!==n.model.sharedModel.getMetadata("deletable");e.isSelectedOrActive(n)&&s&&t.push(i)})),t.length>0&&t.reverse().forEach((e=>{o.sharedModel.deleteCell(e)})),a=t[0];break}}o.sharedModel.insertCells(a,n.map((t=>(t.id="code"===t.cell_type&&"cut"===e.lastClipboardInteraction&&"string"==typeof t.id?t.id:void 0,t))))})),e.activeCellIndex=l+n.length,e.deselectAll(),i&&(e.lastClipboardInteraction="paste"),re.handleState(e,s,!0)}function s(t,n,i){const s=(0,M.findIndex)(i.widgets,((e,n)=>t.model.id===e.model.id));if(-1===s)return-1;if(!i.widgets.length)return s+1;let o=e.getHeadingInfo(t);if(t.isHidden||!(t instanceof se)||!o.isHeading)return s+1;let a,l=!1,d=0;for(a=s+1;a<i.widgets.length;a++){let t=i.widgets[a],s=e.getHeadingInfo(t);if(s.isHeading&&s.headingLevel<=o.headingLevel){a-=1;break}l&&s.isHeading&&s.headingLevel<=d&&(l=!1),n||l?t.setHidden(!0):(s.collapsed&&s.isHeading&&(l=!0,d=s.headingLevel),t.setHidden(!1))}return a===i.widgets.length?t.numberChildNodes=a-s-1:t.numberChildNodes=a-s,e.setCellCollapse(t,n),a+1}function o(e){if(!(e instanceof se))return{isHeading:!1,headingLevel:7};let t=e.headingInfo.level;return{isHeading:t>0,headingLevel:t,collapsed:e.headingCollapsed}}e.splitCell=function(e){if(!e.model||!e.activeCell)return;const t=re.getState(e);e.mode="edit",e.deselectAll();const n=e.model,i=e.activeCellIndex,s=e.widgets[i],o=s.editor;if(!o)return;const a=o.getSelections(),l=s.model.sharedModel.getSource(),d=[0];let r=-1,h=-1;for(let e=0;e<a.length;e++)r=o.getOffsetAt(a[e].start),h=o.getOffsetAt(a[e].end),r<h?(d.push(r),d.push(h)):h<r?(d.push(h),d.push(r)):d.push(r);d.push(l.length);const c=d.slice(0,-1).map(((e,t)=>{const{cell_type:n,metadata:i}=s.model.sharedModel.toJSON();return{cell_type:n,metadata:i,source:l.slice(e,d[t+1]).replace(/^\n+/,"").replace(/\n+$/,"")}}));n.sharedModel.transact((()=>{n.sharedModel.deleteCell(i),n.sharedModel.insertCells(i,c)}));const u=r!==h?2:1;e.activeCellIndex=i+c.length-u,e.scrollToItem(e.activeCellIndex).then((()=>{var t;null===(t=e.activeCell)||void 0===t||t.editor.focus()})).catch((e=>{})),re.handleState(e,t)},e.mergeCells=function(e,t=!1){if(!e.model||!e.activeCell)return;const n=re.getState(e),i=[],s=[],o=e.model,a=o.cells,l=e.activeCell,d=e.activeCellIndex,r={};if(e.widgets.forEach(((t,n)=>{if(e.isSelectedOrActive(t)){i.push(t.model.sharedModel.getSource()),n!==d&&s.push(n);const e=t.model;if(function(e){return"raw"===e.type}(e)||g(e))for(const t of e.attachments.keys)r[t]=e.attachments.get(t).toJSON()}})),1===i.length)if(!0===t){if(0===d)return;const e=a.get(d-1);i.unshift(e.sharedModel.getSource()),s.push(d-1)}else if(!1===t){if(d===a.length-1)return;const e=a.get(d+1);i.push(e.sharedModel.getSource()),s.push(d+1)}e.deselectAll();const h=l.model.sharedModel,{cell_type:c,metadata:u}=h.toJSON();"code"===h.cell_type&&(u.trusted=!0);const p={cell_type:c,metadata:u,source:i.join("\n\n"),attachments:"markdown"===h.cell_type||"raw"===h.cell_type?r:void 0};o.sharedModel.transact((()=>{o.sharedModel.deleteCell(d),o.sharedModel.insertCell(d,p),s.sort(((e,t)=>t-e)).forEach((e=>{o.sharedModel.deleteCell(e)}))})),l instanceof se&&(e.activeCell.rendered=!1),re.handleState(e,n)},e.deleteCells=function(e){if(!e.model||!e.activeCell)return;const t=re.getState(e);re.deleteCells(e),re.handleState(e,t,!0)},e.insertAbove=function(e){if(!e.model)return;const t=re.getState(e),n=e.model,i=e.activeCell?e.activeCellIndex:0;n.sharedModel.insertCell(i,{cell_type:e.notebookConfig.defaultCell,metadata:"code"===e.notebookConfig.defaultCell?{trusted:!0}:{}}),e.activeCellIndex=i,e.deselectAll(),re.handleState(e,t,!0)},e.insertBelow=function(e){if(!e.model)return;const t=re.getState(e),n=e.model,i=e.activeCell?e.activeCellIndex+1:0;n.sharedModel.insertCell(i,{cell_type:e.notebookConfig.defaultCell,metadata:"code"===e.notebookConfig.defaultCell?{trusted:!0}:{}}),e.activeCellIndex=i,e.deselectAll(),re.handleState(e,t,!0)},e.moveDown=function(e){t(e,1)},e.moveUp=function(e){t(e,-1)},e.changeCellType=function(e,t){if(!e.model||!e.activeCell)return;const n=re.getState(e);re.changeCellType(e,t),re.handleState(e,n)},e.run=function(e,t,n,i){if(!e.model||!e.activeCell)return Promise.resolve(!1);const s=re.getState(e),o=re.runSelected(e,t,n,i);return re.handleRunState(e,s,!1),o},e.runAndAdvance=async function(e,t,n,i){var s;if(!e.model||!e.activeCell)return Promise.resolve(!1);const o=re.getState(e),a=re.runSelected(e,t,n,i),l=e.model;return e.activeCellIndex===e.widgets.length-1?(l.sharedModel.insertCell(e.widgets.length,{cell_type:e.notebookConfig.defaultCell,metadata:"code"===e.notebookConfig.defaultCell?{trusted:!0}:{}}),e.activeCellIndex++,!1===(null===(s=e.activeCell)||void 0===s?void 0:s.inViewport)&&await(0,w.signalToPromise)(e.activeCell.inViewportChanged,200).catch((()=>{})),e.mode="edit"):e.activeCellIndex++,re.handleState(e,o,!0),a},e.runAndInsert=async function(e,t,n,i){var s;if(!e.model||!e.activeCell)return Promise.resolve(!1);const o=re.getState(e),a=re.runSelected(e,t,n,i);return e.model.sharedModel.insertCell(e.activeCellIndex+1,{cell_type:e.notebookConfig.defaultCell,metadata:"code"===e.notebookConfig.defaultCell?{trusted:!0}:{}}),e.activeCellIndex++,!1===(null===(s=e.activeCell)||void 0===s?void 0:s.inViewport)&&await(0,w.signalToPromise)(e.activeCell.inViewportChanged,200).catch((()=>{})),e.mode="edit",re.handleState(e,o,!0),a},e.runAll=function(e,t,n,i){if(!e.model||!e.activeCell)return Promise.resolve(!1);const s=re.getState(e);e.widgets.forEach((t=>{e.select(t)}));const o=re.runSelected(e,t,n,i);return re.handleRunState(e,s,!0),o},e.renderAllMarkdown=function(e){if(!e.model||!e.activeCell)return Promise.resolve(!1);const t=e.activeCellIndex,n=re.getState(e);if(e.widgets.forEach(((t,n)=>{"markdown"===t.model.type&&(e.select(t),e.activeCellIndex=n)})),"markdown"!==e.activeCell.model.type)return Promise.resolve(!0);const i=re.runSelected(e);return e.activeCellIndex=t,re.handleRunState(e,n,!0),i},e.runAllAbove=function(e,t,n,i){const{activeCell:s,activeCellIndex:o,model:a}=e;if(!a||!s||o<1)return Promise.resolve(!1);const l=re.getState(e);e.activeCellIndex--,e.deselectAll();for(let t=0;t<e.activeCellIndex;++t)e.select(e.widgets[t]);const d=re.runSelected(e,t,n,i);return e.activeCellIndex++,re.handleRunState(e,l,!0),d},e.runAllBelow=function(e,t,n,i){if(!e.model||!e.activeCell)return Promise.resolve(!1);const s=re.getState(e);e.deselectAll();for(let t=e.activeCellIndex;t<e.widgets.length;++t)e.select(e.widgets[t]);const o=re.runSelected(e,t,n,i);return re.handleRunState(e,s,!0),o},e.replaceSelection=function(e,t){var n,i,s;e.model&&(null===(n=e.activeCell)||void 0===n?void 0:n.editor)&&(null===(s=(i=e.activeCell.editor).replaceSelection)||void 0===s||s.call(i,t))},e.selectAbove=function(e){if(!e.model||!e.activeCell)return;if(0===e.activeCellIndex)return;let t=e.activeCellIndex-1;for(;t>=0;){const n=e.widgets[t];if(!n.inputHidden&&!n.isHidden)break;t-=1}const n=re.getState(e);e.activeCellIndex=t,e.deselectAll(),re.handleState(e,n,!0)},e.selectBelow=function(e){if(!e.model||!e.activeCell)return;let t=e.widgets.length-1;for(;e.widgets[t].isHidden||e.widgets[t].inputHidden;)t-=1;if(e.activeCellIndex===t){const t=e.layout.footer;return void(null==t||t.node.focus())}let n=e.activeCellIndex+1;for(;n<t;){let t=e.widgets[n];if(!t.inputHidden&&!t.isHidden)break;n+=1}const i=re.getState(e);e.activeCellIndex=n,e.deselectAll(),re.handleState(e,i,!0)},e.insertSameLevelHeadingAbove=async function(e){if(!e.model||!e.activeCell)return;let t=re.Headings.determineHeadingLevel(e.activeCell,e);-1==t?await re.Headings.insertHeadingAboveCellIndex(0,1,e):await re.Headings.insertHeadingAboveCellIndex(e.activeCellIndex,t,e)},e.insertSameLevelHeadingBelow=async function(e){if(!e.model||!e.activeCell)return;let t=re.Headings.determineHeadingLevel(e.activeCell,e);t=t>-1?t:1;let n=re.Headings.findLowerEqualLevelHeadingBelow(e.activeCell,e,!0);await re.Headings.insertHeadingAboveCellIndex(-1==n?e.model.cells.length:n,t,e)},e.selectHeadingAboveOrCollapseHeading=function(e){if(!e.model||!e.activeCell)return;const t=re.getState(e);let n=o(e.activeCell);if(n.isHeading&&!n.collapsed)s(e.activeCell,!0,e);else{let t=re.Headings.findLowerEqualLevelParentHeadingAbove(e.activeCell,e,!0);t>-1&&(e.activeCellIndex=t)}e.deselectAll(),re.handleState(e,t,!0)},e.selectHeadingBelowOrExpandHeading=function(e){if(!e.model||!e.activeCell)return;const t=re.getState(e);let n=o(e.activeCell);if(n.isHeading&&n.collapsed)s(e.activeCell,!1,e);else{let t=re.Headings.findHeadingBelow(e.activeCell,e,!0);t>-1&&(e.activeCellIndex=t)}e.deselectAll(),re.handleState(e,t,!0)},e.extendSelectionAbove=function(e,t=!1){if(!e.model||!e.activeCell)return;if(0===e.activeCellIndex)return;const n=re.getState(e);e.mode="command",t?e.extendContiguousSelectionTo(0):e.extendContiguousSelectionTo(e.activeCellIndex-1),re.handleState(e,n,!0)},e.extendSelectionBelow=function(e,t=!1){if(!e.model||!e.activeCell)return;if(e.activeCellIndex===e.widgets.length-1)return;const n=re.getState(e);e.mode="command",t?e.extendContiguousSelectionTo(e.widgets.length-1):e.extendContiguousSelectionTo(e.activeCellIndex+1),re.handleState(e,n,!0)},e.selectAll=function(e){e.model&&e.activeCell&&e.widgets.forEach((t=>{e.select(t)}))},e.deselectAll=function(e){e.model&&e.activeCell&&e.deselectAll()},e.copy=function(e){re.copyOrCut(e,!1)},e.cut=function(e){re.copyOrCut(e,!0)},e.paste=function(e,t="below"){const s=i.Clipboard.getInstance();s.hasData(ae)&&n(e,t,s.getData(ae),!0)},e.duplicate=function(e,t="below"){const i=re.selectedCells(e);i&&0!==i.length&&n(e,t,i,!1)},e.undo=function(e){if(!e.model)return;const t=re.getState(e);e.mode="command",e.model.sharedModel.undo(),e.deselectAll(),re.handleState(e,t)},e.redo=function(e){if(!e.model||!e.activeCell)return;const t=re.getState(e);e.mode="command",e.model.sharedModel.redo(),e.deselectAll(),re.handleState(e,t)},e.toggleAllLineNumbers=function(e){if(!e.model||!e.activeCell)return;const t=re.getState(e),n=e.editorConfig,i=!(n.code.lineNumbers&&n.markdown.lineNumbers&&n.raw.lineNumbers),s={code:{...n.code,lineNumbers:i},markdown:{...n.markdown,lineNumbers:i},raw:{...n.raw,lineNumbers:i}};e.editorConfig=s,re.handleState(e,t)},e.clearOutputs=function(e){if(!e.model||!e.activeCell)return;const t=re.getState(e);let n=-1;for(const t of e.model.cells){const i=e.widgets[++n];e.isSelectedOrActive(i)&&"code"===t.type&&t.sharedModel.transact((()=>{t.clearExecution(),i.outputHidden=!1}),!1)}re.handleState(e,t,!0)},e.clearAllOutputs=function(e){if(!e.model||!e.activeCell)return;const t=re.getState(e);let n=-1;for(const t of e.model.cells){const i=e.widgets[++n];"code"===t.type&&t.sharedModel.transact((()=>{t.clearExecution(),i.outputHidden=!1}),!1)}re.handleState(e,t,!0)},e.hideCode=function(e){if(!e.model||!e.activeCell)return;const t=re.getState(e);e.widgets.forEach((t=>{e.isSelectedOrActive(t)&&"code"===t.model.type&&(t.inputHidden=!0)})),re.handleState(e,t)},e.showCode=function(e){if(!e.model||!e.activeCell)return;const t=re.getState(e);e.widgets.forEach((t=>{e.isSelectedOrActive(t)&&"code"===t.model.type&&(t.inputHidden=!1)})),re.handleState(e,t)},e.hideAllCode=function(e){if(!e.model||!e.activeCell)return;const t=re.getState(e);e.widgets.forEach((e=>{"code"===e.model.type&&(e.inputHidden=!0)})),re.handleState(e,t)},e.showAllCode=function(e){if(!e.model||!e.activeCell)return;const t=re.getState(e);e.widgets.forEach((e=>{"code"===e.model.type&&(e.inputHidden=!1)})),re.handleState(e,t)},e.hideOutput=function(e){if(!e.model||!e.activeCell)return;const t=re.getState(e);e.widgets.forEach((t=>{e.isSelectedOrActive(t)&&"code"===t.model.type&&(t.outputHidden=!0)})),re.handleState(e,t,!0)},e.showOutput=function(e){if(!e.model||!e.activeCell)return;const t=re.getState(e);e.widgets.forEach((t=>{e.isSelectedOrActive(t)&&"code"===t.model.type&&(t.outputHidden=!1)})),re.handleState(e,t)},e.hideAllOutputs=function(e){if(!e.model||!e.activeCell)return;const t=re.getState(e);e.widgets.forEach((e=>{"code"===e.model.type&&(e.outputHidden=!0)})),re.handleState(e,t,!0)},e.renderSideBySide=function(e){e.renderingLayout="side-by-side"},e.renderDefault=function(e){e.renderingLayout="default"},e.showAllOutputs=function(e){if(!e.model||!e.activeCell)return;const t=re.getState(e);e.widgets.forEach((e=>{"code"===e.model.type&&(e.outputHidden=!1)})),re.handleState(e,t)},e.enableOutputScrolling=function(e){if(!e.model||!e.activeCell)return;const t=re.getState(e);e.widgets.forEach((t=>{e.isSelectedOrActive(t)&&"code"===t.model.type&&(t.outputsScrolled=!0)})),re.handleState(e,t,!0)},e.disableOutputScrolling=function(e){if(!e.model||!e.activeCell)return;const t=re.getState(e);e.widgets.forEach((t=>{e.isSelectedOrActive(t)&&"code"===t.model.type&&(t.outputsScrolled=!1)})),re.handleState(e,t)},e.selectLastRunCell=function(e){let t=null,n=null;e.widgets.forEach(((e,i)=>{if("code"===e.model.type){const s=e.model.getMetadata("execution");if(s&&S.JSONExt.isObject(s)&&void 0!==s["iopub.status.busy"]){const e=s["iopub.status.busy"].toString();if(e){const s=new Date(e);(!t||s>=t)&&(t=s,n=i)}}}})),null!==n&&(e.activeCellIndex=n)},e.setMarkdownHeader=function(e,t){if(!e.model||!e.activeCell)return;const n=re.getState(e),i=e.model.cells;t=Math.min(Math.max(t,1),6),e.widgets.forEach(((n,s)=>{e.isSelectedOrActive(n)&&re.setMarkdownHeader(i.get(s),t)})),re.changeCellType(e,"markdown"),re.handleState(e,n)},e.collapseAllHeadings=function(t){for(const n of t.widgets)e.getHeadingInfo(n).isHeading&&(e.setHeadingCollapse(n,!0,t),e.setCellCollapse(n,!0))},e.expandAllHeadings=function(t){for(const n of t.widgets)e.getHeadingInfo(n).isHeading&&(e.setHeadingCollapse(n,!1,t),e.setCellCollapse(n,!1))},e.expandParent=function e(t,n){let i=function(e,t){const n=(0,M.findIndex)(t.widgets,((t,n)=>e.model.id===t.model.id));if(-1===n)return;if(n>=t.widgets.length)return;let i=o(t.widgets[n]);for(let e=n-1;e>=0;e--)if(e<t.widgets.length){let n=o(t.widgets[e]);if(n.isHeading&&n.headingLevel<i.headingLevel)return t.widgets[e]}}(t,n);i&&(o(i).collapsed||i.isHidden)&&(i.isHidden&&e(i,n),o(i).collapsed&&s(i,!1,n))},e.findNextParentHeading=function(e,t){let n=(0,M.findIndex)(t.widgets,((t,n)=>e.model.id===t.model.id));if(-1===n)return-1;let i=o(e);for(n+=1;n<t.widgets.length;n++){let e=o(t.widgets[n]);if(e.isHeading&&e.headingLevel<=i.headingLevel)return n}return t.widgets.length},e.setHeadingCollapse=s,e.toggleCurrentHeadingCollapse=function(t){if(!t.activeCell||void 0===t.activeCellIndex)return;let n=e.getHeadingInfo(t.activeCell);n.isHeading&&e.setHeadingCollapse(t.activeCell,!n.collapsed,t),t.scrollToItem(t.activeCellIndex).catch((e=>{}))},e.setCellCollapse=function(e,t){e instanceof se?e.headingCollapsed=t:e.setHidden(t)},e.getHeadingInfo=o,e.trust=function(e,t){const n=(t=t||x.nullTranslator).load("jupyterlab");if(!e.model)return Promise.resolve();const s=(0,M.every)(e.model.cells,(e=>e.trusted)),o=N.createElement("p",null,n.__("A trusted Jupyter notebook may execute hidden malicious code when you open it."),N.createElement("br",null),n.__('Selecting "Trust" will re-render this notebook in a trusted state.'),N.createElement("br",null),n.__("For more information, see")," ",N.createElement("a",{href:"https://jupyter-server.readthedocs.io/en/stable/operators/security.html",target:"_blank",rel:"noopener noreferrer"},n.__("the Jupyter security documentation")),".");return s?(0,i.showDialog)({body:n.__("Notebook is already trusted"),buttons:[i.Dialog.okButton()]}).then((()=>{})):(0,i.showDialog)({body:o,title:n.__("Trust this notebook?"),buttons:[i.Dialog.cancelButton(),i.Dialog.warnButton({label:n.__("Trust"),ariaLabel:n.__("Confirm Trusting this notebook")})]}).then((t=>{if(t.button.accept&&e.model)for(const t of e.model.cells)t.trusted=!0}))}}(de||(de={})),function(e){function t(e){var t,n;return{wasFocused:e.node.contains(document.activeElement),activeCellId:null!==(n=null===(t=e.activeCell)||void 0===t?void 0:t.model.id)&&void 0!==n?n:null}}function n(e,t,n=!1){const{activeCell:i,activeCellIndex:s}=e;(t.wasFocused||"edit"===e.mode)&&e.activate(),n&&i&&e.scrollToItem(s,"smart",.05).catch((e=>{}))}function o(e){const t=e.model.sharedModel,n=[];e.mode="command",e.widgets.forEach(((t,i)=>{var s;const o=!1!==t.model.getMetadata("deletable");e.isSelectedOrActive(t)&&o&&(n.push(i),null===(s=e.model)||void 0===s||s.deletedCells.push(t.model.id))})),n.length>0&&(t.transact((()=>{n.reverse().forEach((e=>{t.deleteCell(e)})),t.cells.length==n.length&&t.insertCell(0,{cell_type:e.notebookConfig.defaultCell,metadata:"code"===e.notebookConfig.defaultCell?{trusted:!0}:{}})})),e.activeCellIndex=n[0]-n.length+1),e.deselectAll()}let a;e.executed=new s.Signal({}),e.executionScheduled=new s.Signal({}),e.selectionExecuted=new s.Signal({}),e.getState=t,e.handleState=n,e.handleRunState=function(e,t,n=!1){var i;if((t.wasFocused||"edit"===e.mode)&&e.activate(),n&&t.activeCellId){const n=e.widgets.findIndex((e=>e.model.id===t.activeCellId));(null===(i=e.widgets[n])||void 0===i?void 0:i.inputArea)&&e.scrollToItem(n).catch((e=>{}))}},e.runSelected=function(t,n,s,o){t.mode="command";let a=t.activeCellIndex;const l=t.widgets.filter(((e,n)=>{const i=t.isSelectedOrActive(e);return i&&(a=n),i}));return t.activeCellIndex=a,t.deselectAll(),Promise.all(l.map((a=>async function(t,n,s,o,a){var l,d,r;const h=(a=a||x.nullTranslator).load("jupyterlab");switch(n.model.type){case"markdown":n.rendered=!0,n.inputHidden=!1,e.executed.emit({notebook:t,cell:n,success:!0});break;case"code":if(s){if(s.isTerminating){await(0,i.showDialog)({title:h.__("Kernel Terminating"),body:h.__("The kernel for %1 appears to be terminating. You can not run any cell for now.",null===(l=s.session)||void 0===l?void 0:l.path),buttons:[i.Dialog.okButton()]});break}if(s.pendingInput)return await(0,i.showDialog)({title:h.__("Cell not executed due to pending input"),body:h.__("The cell has not been executed to avoid kernel deadlock as there is another pending input! Submit your pending input and try again."),buttons:[i.Dialog.okButton()]}),!1;if(s.hasNoKernel&&await s.startKernel()&&o&&await o.selectKernel(s),s.hasNoKernel)return n.model.sharedModel.transact((()=>{n.model.clearExecution()})),!0;const a=null!==(r=null===(d=t.model)||void 0===d?void 0:d.deletedCells)&&void 0!==r?r:[];e.executionScheduled.emit({notebook:t,cell:n});let c=!1;try{const e=await ne.execute(n,s,{deletedCells:a,recordTiming:t.notebookConfig.recordTiming});a.splice(0,a.length),c=(()=>{if(n.isDisposed)return!1;if(!e)return!0;if("ok"===e.content.status){const i=e.content;return i.payload&&i.payload.length&&function(e,t,n){var i;const s=null===(i=e.payload)||void 0===i?void 0:i.filter((e=>"set_next_input"===e.source))[0];if(!s)return;const o=s.text;if(s.replace)return void n.model.sharedModel.setSource(o);const a=t.model.sharedModel,l=t.model.cells,d=(0,M.findIndex)(l,(e=>e===n.model));-1===d?a.insertCell(a.cells.length,{cell_type:"code",source:o,metadata:{trusted:!1}}):a.insertCell(d+1,{cell_type:"code",source:o,metadata:{trusted:!1}})}(i,t,n),!0}throw new le(e.content)})()}catch(i){if(!n.isDisposed&&!i.message.startsWith("Canceled"))throw e.executed.emit({notebook:t,cell:n,success:!1,error:i}),i;c=!1}return c&&e.executed.emit({notebook:t,cell:n,success:!0}),c}n.model.sharedModel.transact((()=>{n.model.clearExecution()}),!1)}return Promise.resolve(!0)}(t,a,n,s,o)))).then((n=>!t.isDisposed&&(e.selectionExecuted.emit({notebook:t,lastCell:t.widgets[a]}),t.update(),n.every((e=>e))))).catch((n=>{if(!n.message.startsWith("KernelReplyNotOK"))throw n;return l.map((e=>{"code"===e.model.type&&null==e.model.executionCount&&e.setPrompt("")})),e.selectionExecuted.emit({notebook:t,lastCell:t.widgets[a]}),t.update(),!1}))},e.selectedCells=function(e){return e.widgets.filter((t=>e.isSelectedOrActive(t))).map((e=>e.model.toJSON())).map((e=>(void 0!==e.metadata.deletable&&delete e.metadata.deletable,e)))},e.copyOrCut=function(s,a){if(!s.model||!s.activeCell)return;const l=t(s),d=i.Clipboard.getInstance();s.mode="command",d.clear();const r=e.selectedCells(s);d.setData(ae,r),a?o(s):s.deselectAll(),s.lastClipboardInteraction=a?"cut":"copy",n(s,l)},e.changeCellType=function(e,t){const n=e.model.sharedModel;e.widgets.forEach(((i,s)=>{if(e.isSelectedOrActive(i)){if(i.model.type!==t){const e=i.model.toJSON();n.transact((()=>{n.deleteCell(s),e.metadata.trusted="code"===t||void 0;const i=n.insertCell(s,{cell_type:t,source:e.source,metadata:e.metadata});e.attachments&&["markdown","raw"].includes(t)&&(i.attachments=e.attachments)}))}"markdown"===t&&((i=e.widgets[s]).rendered=!1)}})),e.deselectAll()},e.deleteCells=o,e.setMarkdownHeader=function(e,t){let n=e.sharedModel.getSource();const i=Array(t+1).join("#")+" ",s=/^(#+\s*)|^(\s*)/.exec(n);s&&(n=n.slice(s[0].length)),e.sharedModel.setSource(i+n)},function(t){function n(e,t,n=!1,i=!1){let s=t.widgets.indexOf(e)-(n?1:0);for(;s>=0;){if(de.getHeadingInfo(t.widgets[s]).isHeading)return i?s:t.widgets[s];s--}return i?-1:null}t.findParentHeading=n,t.findLowerEqualLevelParentHeadingAbove=function(t,n,i=!1){let s=e.Headings.determineHeadingLevel(t,n);-1==s&&(s=1);let o=n.widgets.indexOf(t)-1;for(;o>=0;){let e=n.widgets[o],t=de.getHeadingInfo(e);if(t.isHeading&&t.headingLevel<=s)return i?o:e;o--}return i?-1:null},t.findLowerEqualLevelHeadingBelow=function(t,n,i=!1){let s=e.Headings.determineHeadingLevel(t,n);-1==s&&(s=1);let o=n.widgets.indexOf(t)+1;for(;o<n.widgets.length;){let e=n.widgets[o],t=de.getHeadingInfo(e);if(t.isHeading&&t.headingLevel<=s)return i?o:e;o++}return i?-1:null},t.findHeadingBelow=function(e,t,n=!1){let i=t.widgets.indexOf(e)+1;for(;i<t.widgets.length;){let e=t.widgets[i];if(de.getHeadingInfo(e).isHeading)return n?i:e;i++}return n?-1:null},t.determineHeadingLevel=function(e,t){let i=de.getHeadingInfo(e);if(i.isHeading)return i.headingLevel;{let i=n(e,t,!0);return null==i?-1:de.getHeadingInfo(i).headingLevel}},t.insertHeadingAboveCellIndex=async function(t,n,i){var s;n=Math.min(Math.max(n,1),6);const o=e.getState(i);i.model.sharedModel.insertCell(t,{cell_type:"markdown",source:"#".repeat(n)+" "}),i.activeCellIndex=t,!1===(null===(s=i.activeCell)||void 0===s?void 0:s.inViewport)&&await(0,w.signalToPromise)(i.activeCell.inViewportChanged,200).catch((()=>{})),i.deselectAll(),e.handleState(i,o,!0),i.mode="edit",i.widgets[t].setHidden(!1)}}(a=e.Headings||(e.Headings={}))}(re||(re={}));class ce{constructor(e){this.model=e,this._cellMap=new WeakMap,this._changed=new s.Signal(this),this._isDisposed=!1,this._insertCells(0,this.model.cells),this.model.changed.connect(this._onSharedModelChanged,this)}get changed(){return this._changed}get isDisposed(){return this._isDisposed}get length(){return this.model.cells.length}*[Symbol.iterator](){for(const e of this.model.cells)yield this._cellMap.get(e)}dispose(){var e;if(!this._isDisposed){this._isDisposed=!0;for(const t of this.model.cells)null===(e=this._cellMap.get(t))||void 0===e||e.dispose();s.Signal.clearData(this)}}get(e){return this._cellMap.get(this.model.cells[e])}_insertCells(e,t){return t.forEach((e=>{let t;switch(e.cell_type){case"code":t=new v({sharedModel:e});break;case"markdown":t=new _({sharedModel:e});break;default:t=new C({sharedModel:e})}this._cellMap.set(e,t),e.disposed.connect((()=>{t.dispose(),this._cellMap.delete(e)}))})),this.length}_onSharedModelChanged(e,t){var n;let i=0;const s=new Array;null===(n=t.cellsChange)||void 0===n||n.forEach((e=>{null!=e.insert?(this._insertCells(i,e.insert),s.push({type:"add",newIndex:i,newValues:e.insert.map((e=>this._cellMap.get(e))),oldIndex:-2,oldValues:[]}),i+=e.insert.length):null!=e.delete?s.push({type:"remove",newIndex:-1,newValues:[],oldIndex:i,oldValues:new Array(e.delete).fill(void 0)}):null!=e.retain&&(i+=e.retain)})),s.forEach((e=>this._changed.emit(e)))}}!function(e){function t(e,t){const n=(t||x.nullTranslator).load("jupyterlab");function s(){if(e.context.model.readOnly)return(0,i.showDialog)({title:n.__("Cannot Save"),body:n.__("Document is read-only"),buttons:[i.Dialog.okButton()]});e.context.save().then((()=>{if(!e.isDisposed)return e.context.createCheckpoint()}))}return(0,k.addToolbarButtonClass)(k.ReactWidget.create(N.createElement(k.UseSignal,{signal:e.context.fileChanged},(()=>N.createElement(k.ToolbarButtonComponent,{icon:k.saveIcon,onClick:s,tooltip:n.__("Save the notebook contents and create checkpoint"),enabled:!!(e&&e.context&&e.context.contentsModel&&e.context.contentsModel.writable)})))))}function n(e,t){const n=(t||x.nullTranslator).load("jupyterlab");return new k.ToolbarButton({icon:k.addIcon,onClick:()=>{de.insertBelow(e.content)},tooltip:n.__("Insert a cell below")})}function s(e,t){const n=(t||x.nullTranslator).load("jupyterlab");return new k.ToolbarButton({icon:k.cutIcon,onClick:()=>{de.cut(e.content)},tooltip:n.__("Cut the selected cells")})}function o(e,t){const n=(t||x.nullTranslator).load("jupyterlab");return new k.ToolbarButton({icon:k.copyIcon,onClick:()=>{de.copy(e.content)},tooltip:n.__("Copy the selected cells")})}function a(e,t){const n=(t||x.nullTranslator).load("jupyterlab");return new k.ToolbarButton({icon:k.pasteIcon,onClick:()=>{de.paste(e.content)},tooltip:n.__("Paste cells from the clipboard")})}function l(e,t,n){const i=(null!=n?n:x.nullTranslator).load("jupyterlab");return new k.ToolbarButton({icon:k.runIcon,onClick:()=>{de.runAndAdvance(e.content,e.sessionContext,t,n)},tooltip:i.__("Run the selected cells and advance")})}function d(e,t,n){const s=(null!=n?n:x.nullTranslator).load("jupyterlab");return new k.ToolbarButton({icon:k.fastForwardIcon,onClick:()=>{const s=null!=t?t:new i.SessionContextDialogs({translator:n});s.restart(e.sessionContext).then((t=>(t&&de.runAll(e.content,e.sessionContext,s,n),t)))},tooltip:s.__("Restart the kernel, then re-run the whole notebook")})}function r(e,t){return new ue(e.content,t)}e.createSaveButton=t,e.createInsertButton=n,e.createCutButton=s,e.createCopyButton=o,e.createPasteButton=a,e.createRunButton=l,e.createRestartRunAllButton=d,e.createCellTypeItem=r,e.getDefaultItems=function(e,h,c){return[{name:"save",widget:t(e,c)},{name:"insert",widget:n(e,c)},{name:"cut",widget:s(e,c)},{name:"copy",widget:o(e,c)},{name:"paste",widget:a(e,c)},{name:"run",widget:l(e,h,c)},{name:"interrupt",widget:i.Toolbar.createInterruptButton(e.sessionContext,c)},{name:"restart",widget:i.Toolbar.createRestartButton(e.sessionContext,h,c)},{name:"restart-and-run",widget:d(e,h,c)},{name:"cellType",widget:r(e,c)},{name:"spacer",widget:k.Toolbar.createSpacerItem()},{name:"kernelName",widget:i.Toolbar.createKernelNameItem(e.sessionContext,h,c)}]}}(he||(he={}));class ue extends k.ReactWidget{constructor(e,t){super(),this.handleChange=e=>{"-"!==e.target.value&&(de.changeCellType(this._notebook,e.target.value),this._notebook.activate())},this.handleKeyDown=e=>{13===e.keyCode&&this._notebook.activate()},this._trans=(t||x.nullTranslator).load("jupyterlab"),this.addClass("jp-Notebook-toolbarCellType"),this._notebook=e,e.model&&this.update(),e.activeCellChanged.connect(this.update,this),e.selectionChanged.connect(this.update,this)}render(){let e="-";this._notebook.activeCell&&(e=this._notebook.activeCell.model.type);for(const t of this._notebook.widgets)if(this._notebook.isSelectedOrActive(t)&&t.model.type!==e){e="-";break}return N.createElement(k.HTMLSelect,{className:"jp-Notebook-toolbarCellTypeDropdown",onChange:this.handleChange,onKeyDown:this.handleKeyDown,value:e,"aria-label":this._trans.__("Cell type"),title:this._trans.__("Select the cell type")},N.createElement("option",{value:"-"},"-"),N.createElement("option",{value:"code"},this._trans.__("Code")),N.createElement("option",{value:"markdown"},this._trans.__("Markdown")),N.createElement("option",{value:"raw"},this._trans.__("Raw")))}}var ge=n(22970),pe=n(78029);function me(e){const t=e.translator||x.nullTranslator,n=(0,i.translateKernelStatuses)(t),s=t.load("jupyterlab"),o=e.state,a=e.displayOption.showOnToolBar,l=e.displayOption.showProgress,d=a?"down":"up",r=D().createElement("div",null);if(!o)return r;const h=o.kernelStatus,c={alignSelf:"normal",height:"24px"},u=o.totalTime,g=o.scheduledCellNumber||0,p=g-(o.scheduledCell.size||0);let m=100*p/g,C=l?"":"hidden";!l&&m<100&&(m=0);const _=e=>D().createElement(ge._3,{progress:e,width:16,height:24,label:s.__("Kernel status")}),v=e=>s.__("Kernel status: %1",e),f=(e,t,i)=>D().createElement("div",{className:"jp-Notebook-ExecutionIndicator",title:l?"":v(n[e]),"data-status":e},t,D().createElement("div",{className:`jp-Notebook-ExecutionIndicator-tooltip ${d} ${C}`},D().createElement("span",null," ",v(n[e])," "),i));if("connecting"===o.kernelStatus||"disconnected"===o.kernelStatus||"unknown"===o.kernelStatus)return f(h,D().createElement(k.offlineBoltIcon.react,{...c}),[]);if("starting"===o.kernelStatus||"terminating"===o.kernelStatus||"restarting"===o.kernelStatus||"initializing"===o.kernelStatus)return f(h,D().createElement(k.circleIcon.react,{...c}),[]);if("busy"===o.executionStatus)return f("busy",_(m),[D().createElement("span",{key:0},s.__(`Executed ${p}/${g} cells`)),D().createElement("span",{key:1},s._n("Elapsed time: %1 second","Elapsed time: %1 seconds",u))]);{const e="busy"===o.kernelStatus?0:100,t="busy"===o.kernelStatus||0===u?[]:[D().createElement("span",{key:0},s._n("Executed %1 cell","Executed %1 cells",g)),D().createElement("span",{key:1},s._n("Elapsed time: %1 second","Elapsed time: %1 seconds",u))];return f(o.kernelStatus,_(e),t)}}class Ce extends k.VDomRenderer{constructor(e,t=!0){super(new Ce.Model),this.translator=e||x.nullTranslator,this.addClass("jp-mod-highlighted")}render(){if(null!==this.model&&this.model.renderFlag){const e=this.model.currentNotebook;return e?D().createElement(me,{displayOption:this.model.displayOption,state:this.model.executionState(e),translator:this.translator}):D().createElement(me,{displayOption:this.model.displayOption,state:void 0,translator:this.translator})}return D().createElement("div",null)}}!function(e){class t extends k.VDomModel{constructor(){super(),this._notebookExecutionProgress=new WeakMap,this._displayOption={showOnToolBar:!0,showProgress:!0},this._renderFlag=!0}attachNotebook(e){var t,n,i,s;if(e&&e.content&&e.context){const o=e.content,a=e.context;if(this._currentNotebook=o,!this._notebookExecutionProgress.has(o)){this._notebookExecutionProgress.set(o,{executionStatus:"idle",kernelStatus:"idle",totalTime:0,interval:0,timeout:0,scheduledCell:new Set,scheduledCellNumber:0,needReset:!0});const e=this._notebookExecutionProgress.get(o),l=t=>{e&&(e.kernelStatus=t.kernelDisplayStatus),this.stateChanged.emit(void 0)};a.statusChanged.connect(l,this);const d=t=>{e&&(e.kernelStatus=t.kernelDisplayStatus),this.stateChanged.emit(void 0)};a.connectionStatusChanged.connect(d,this),a.disposed.connect((e=>{e.connectionStatusChanged.disconnect(d,this),e.statusChanged.disconnect(l,this)}));const r=(e,t)=>{const n=t.msg,i=n.header.msg_id;if("execute_request"===n.header.msg_type)this._cellScheduledCallback(o,i);else if(pe.KernelMessage.isStatusMsg(n)&&"idle"===n.content.execution_state){const e=n.parent_header.msg_id;this._cellExecutedCallback(o,e)}else pe.KernelMessage.isStatusMsg(n)&&"restarting"===n.content.execution_state?this._restartHandler(o):"execute_input"===n.header.msg_type&&this._startTimer(o)};null===(n=null===(t=a.session)||void 0===t?void 0:t.kernel)||void 0===n||n.anyMessage.connect(r),null===(s=null===(i=a.session)||void 0===i?void 0:i.kernel)||void 0===s||s.disposed.connect((e=>e.anyMessage.disconnect(r)));const h=(t,n)=>{e&&(this._resetTime(e),this.stateChanged.emit(void 0),n.newValue&&n.newValue.anyMessage.connect(r))};a.kernelChanged.connect(h),a.disposed.connect((e=>e.kernelChanged.disconnect(h)))}}}get currentNotebook(){return this._currentNotebook}get displayOption(){return this._displayOption}set displayOption(e){this._displayOption=e}executionState(e){return this._notebookExecutionProgress.get(e)}_scheduleSwitchToIdle(e){window.setTimeout((()=>{e.executionStatus="idle",clearInterval(e.interval),this.stateChanged.emit(void 0)}),150),e.timeout=window.setTimeout((()=>{e.needReset=!0}),1e3)}_cellExecutedCallback(e,t){const n=this._notebookExecutionProgress.get(e);n&&n.scheduledCell.has(t)&&(n.scheduledCell.delete(t),0===n.scheduledCell.size&&this._scheduleSwitchToIdle(n))}_restartHandler(e){const t=this._notebookExecutionProgress.get(e);t&&(t.scheduledCell.clear(),this._scheduleSwitchToIdle(t))}_startTimer(e){const t=this._notebookExecutionProgress.get(e);t&&(t.scheduledCell.size>0?"busy"!==t.executionStatus&&(t.executionStatus="busy",clearTimeout(t.timeout),this.stateChanged.emit(void 0),t.interval=window.setInterval((()=>{this._tick(t)}),1e3)):this._resetTime(t))}_cellScheduledCallback(e,t){const n=this._notebookExecutionProgress.get(e);n&&!n.scheduledCell.has(t)&&(n.needReset&&this._resetTime(n),n.scheduledCell.add(t),n.scheduledCellNumber+=1)}_tick(e){e.totalTime+=1,this.stateChanged.emit(void 0)}_resetTime(e){e.totalTime=0,e.scheduledCellNumber=0,e.executionStatus="idle",e.scheduledCell=new Set,clearTimeout(e.timeout),clearInterval(e.interval),e.needReset=!1}get renderFlag(){return this._renderFlag}updateRenderOption(e){this.displayOption.showOnToolBar&&(e.showOnToolBar?this._renderFlag=!0:this._renderFlag=!1),this.displayOption.showProgress=e.showProgress,this.stateChanged.emit(void 0)}}function n(e){let t=!0,n=!0;const i=e.get("kernelStatus").composite;return i&&(t=!i.showOnStatusBar,n=i.showProgress),{showOnToolBar:t,showProgress:n}}e.Model=t,e.createExecutionIndicatorItem=function(t,i,s){const o=new e(i);return o.model.displayOption={showOnToolBar:!0,showProgress:!0},o.model.attachNotebook({content:t.content,context:t.sessionContext}),s&&s.then((e=>{const t=e=>{o.model.updateRenderOption(n(e))};e.changed.connect(t),t(e),o.disposed.connect((()=>{e.changed.disconnect(t)}))})).catch((e=>{console.error(e.message)})),o},e.getSettingValue=n}(Ce||(Ce={}));var _e=n(63655);class ve{constructor(e={}){var t,n;this.standaloneModel=!1,this._dirty=!1,this._readOnly=!1,this._contentChanged=new s.Signal(this),this._stateChanged=new s.Signal(this),this._isDisposed=!1,this._metadataChanged=new s.Signal(this),this.standaloneModel=void 0===e.sharedModel,e.sharedModel?this.sharedModel=e.sharedModel:this.sharedModel=c.YNotebook.create({disableDocumentWideUndoRedo:null===(t=e.disableDocumentWideUndoRedo)||void 0===t||t,data:{nbformat:_e.pB,nbformat_minor:_e.hz,metadata:{kernelspec:{name:"",display_name:""},language_info:{name:null!==(n=e.languagePreference)&&void 0!==n?n:""}}}}),this._cells=new ce(this.sharedModel),this._trans=(e.translator||x.nullTranslator).load("jupyterlab"),this._deletedCells=[],this._collaborationEnabled=!!(null==e?void 0:e.collaborationEnabled),this._cells.changed.connect(this._onCellsChanged,this),this.sharedModel.changed.connect(this._onStateChanged,this),this.sharedModel.metadataChanged.connect(this._onMetadataChanged,this)}get contentChanged(){return this._contentChanged}get metadataChanged(){return this._metadataChanged}get stateChanged(){return this._stateChanged}get cells(){return this._cells}get dirty(){return this._dirty}set dirty(e){const t=this._dirty;e!==t&&(this._dirty=e,this.triggerStateChange({name:"dirty",oldValue:t,newValue:e}))}get readOnly(){return this._readOnly}set readOnly(e){if(e===this._readOnly)return;const t=this._readOnly;this._readOnly=e,this.triggerStateChange({name:"readOnly",oldValue:t,newValue:e})}get metadata(){return this.sharedModel.metadata}get nbformat(){return this.sharedModel.nbformat}get nbformatMinor(){return this.sharedModel.nbformat_minor}get defaultKernelName(){var e;const t=this.getMetadata("kernelspec");return null!==(e=null==t?void 0:t.name)&&void 0!==e?e:""}get deletedCells(){return this._deletedCells}get defaultKernelLanguage(){var e;const t=this.getMetadata("language_info");return null!==(e=null==t?void 0:t.name)&&void 0!==e?e:""}get collaborative(){return this._collaborationEnabled}dispose(){if(this.isDisposed)return;this._isDisposed=!0;const e=this.cells;this._cells=null,e.dispose(),this.standaloneModel&&this.sharedModel.dispose(),s.Signal.clearData(this)}deleteMetadata(e){return this.sharedModel.deleteMetadata(e)}getMetadata(e){return this.sharedModel.getMetadata(e)}setMetadata(e,t){void 0===t?this.sharedModel.deleteMetadata(e):this.sharedModel.setMetadata(e,t)}toString(){return JSON.stringify(this.toJSON())}fromString(e){this.fromJSON(JSON.parse(e))}toJSON(){return this._ensureMetadata(),this.sharedModel.toJSON()}fromJSON(e){var t,n;const s=S.JSONExt.deepCopy(e),o=e.metadata.orig_nbformat;if(s.nbformat=Math.max(e.nbformat,_e.pB),(s.nbformat!==e.nbformat||s.nbformat_minor<_e.hz)&&(s.nbformat_minor=_e.hz),void 0!==o&&s.nbformat!==o){let e;e=s.nbformat>o?this._trans.__("This notebook has been converted from an older notebook format (v%1)\nto the current notebook format (v%2).\nThe next time you save this notebook, the current notebook format (v%2) will be used.\n'Older versions of Jupyter may not be able to read the new format.' To preserve the original format version,\nclose the notebook without saving it.",o,s.nbformat):this._trans.__("This notebook has been converted from an newer notebook format (v%1)\nto the current notebook format (v%2).\nThe next time you save this notebook, the current notebook format (v%2) will be used.\nSome features of the original notebook may not be available.' To preserve the original format version,\nclose the notebook without saving it.",o,s.nbformat),(0,i.showDialog)({title:this._trans.__("Notebook converted"),body:e,buttons:[i.Dialog.okButton({label:this._trans.__("Ok")})]})}0===(null!==(n=null===(t=s.cells)||void 0===t?void 0:t.length)&&void 0!==n?n:0)&&(s.cells=[{cell_type:"code",source:"",metadata:{trusted:!0}}]),this.sharedModel.fromJSON(s),this._ensureMetadata(),this.dirty=!0}_onCellsChanged(e,t){switch(t.type){case"add":case"set":t.newValues.forEach((e=>{e.contentChanged.connect(this.triggerContentChange,this)}))}this.triggerContentChange()}_onMetadataChanged(e,t){this._metadataChanged.emit(t),this.triggerContentChange()}_onStateChanged(e,t){t.stateChange&&t.stateChange.forEach((e=>{"dirty"===e.name?this.dirty=e.newValue:e.oldValue!==e.newValue&&this.triggerStateChange({newValue:void 0,oldValue:void 0,...e})}))}_ensureMetadata(e=""){this.getMetadata("language_info")||this.sharedModel.setMetadata("language_info",{name:e}),this.getMetadata("kernelspec")||this.sharedModel.setMetadata("kernelspec",{name:"",display_name:""})}triggerStateChange(e){this._stateChanged.emit(e)}triggerContentChange(){this._contentChanged.emit(void 0),this.dirty=!0}get isDisposed(){return this._isDisposed}}class fe{constructor(e={}){var t,n;this._disposed=!1,this._disableDocumentWideUndoRedo=null===(t=e.disableDocumentWideUndoRedo)||void 0===t||t,this._collaborative=null===(n=e.collaborative)||void 0===n||n}get disableDocumentWideUndoRedo(){return this._disableDocumentWideUndoRedo}set disableDocumentWideUndoRedo(e){this._disableDocumentWideUndoRedo=e}get name(){return"notebook"}get contentType(){return"notebook"}get fileFormat(){return"json"}get collaborative(){return this._collaborative}get isDisposed(){return this._disposed}dispose(){this._disposed=!0}createNew(e={}){return new ve({languagePreference:e.languagePreference,sharedModel:e.sharedModel,collaborationEnabled:e.collaborationEnabled&&this.collaborative,disableDocumentWideUndoRedo:this._disableDocumentWideUndoRedo})}preferredLanguage(e){return""}}function we(e){const t=(e.translator||x.nullTranslator).load("jupyterlab");return N.createElement(ge.Jy,{source:t.__("Mode: %1",e.modeNames[e.notebookMode])})}class ye extends k.VDomRenderer{constructor(e){super(new ye.Model),this.translator=e||x.nullTranslator,this._trans=this.translator.load("jupyterlab"),this._modeNames={command:this._trans.__("Command"),edit:this._trans.__("Edit")}}render(){return this.model?(this.node.title=this._trans.__("Notebook is in %1 mode",this._modeNames[this.model.notebookMode]),N.createElement(we,{notebookMode:this.model.notebookMode,translator:this.translator,modeNames:this._modeNames})):null}}!function(e){class t extends k.VDomModel{constructor(){super(...arguments),this._onChanged=e=>{const t=this._notebookMode;this._notebook?this._notebookMode=e.mode:this._notebookMode="command",this._triggerChange(t,this._notebookMode)},this._notebookMode="command",this._notebook=null}get notebookMode(){return this._notebookMode}set notebook(e){const t=this._notebook;null!==t&&(t.stateChanged.disconnect(this._onChanged,this),t.activeCellChanged.disconnect(this._onChanged,this),t.modelContentChanged.disconnect(this._onChanged,this));const n=this._notebookMode;this._notebook=e,null===this._notebook?this._notebookMode="command":(this._notebookMode=this._notebook.mode,this._notebook.stateChanged.connect(this._onChanged,this),this._notebook.activeCellChanged.connect(this._onChanged,this),this._notebook.modelContentChanged.connect(this._onChanged,this)),this._triggerChange(n,this._notebookMode)}_triggerChange(e,t){e!==t&&this.stateChanged.emit(void 0)}}e.Model=t}(ye||(ye={}));var be=n(10081),xe=n(91058),ke=n(28215);class Se extends be.s{constructor(e,t){super(e,t),this.editorWidget=e,this.options=t,this._type="code",this._readyDelegate=new S.PromiseDelegate,this._editorToCell=new Map,this.editor=e.content,this._cellToEditor=new WeakMap,Promise.all([this.widget.context.sessionContext.ready,this.connectionManager.ready]).then((async()=>{await this.initOnceReady(),this._readyDelegate.resolve()})).catch(console.error)}get documentPath(){return this.widget.context.path}get mimeType(){var e;let t,n=this.language_info();return t=n&&n.mimetype?n.mimetype:this.widget.content.codeMimetype,Array.isArray(t)?null!==(e=t[0])&&void 0!==e?e:"text/plain":t}get languageFileExtension(){let e=this.language_info();if(e&&e.file_extension)return e.file_extension.replace(".","")}get wrapperElement(){return this.widget.node}get editors(){if(this.isDisposed)return[];let e=this.widget.content;return this._editorToCell.clear(),e.isDisposed?[]:e.widgets.map((e=>({ceEditor:this._getCellEditor(e),type:e.model.type,value:e.model.sharedModel.getSource()})))}get activeEditor(){return this.editor.activeCell?this._getCellEditor(this.editor.activeCell):void 0}get ready(){return this._readyDelegate.promise}getEditorIndexAt(e){let t=this._getCellAt(e);return this.widget.content.widgets.findIndex((e=>t===e))}getEditorIndex(e){let t=this._editorToCell.get(e);return this.editor.widgets.findIndex((e=>t===e))}getEditorWrapper(e){return this._editorToCell.get(e).node}async onKernelChanged(e,t){if(t.newValue)try{const e=this._languageInfo;await(0,xe.TS)(this.isReady,-1),await this._updateLanguageInfo();const t=this._languageInfo;(null==e?void 0:e.name)!=t.name||(null==e?void 0:e.mimetype)!=(null==t?void 0:t.mimetype)||(null==e?void 0:e.file_extension)!=(null==t?void 0:t.file_extension)?(console.log(`Changed to ${this._languageInfo.name} kernel, reconnecting`),this.reloadConnection()):console.log("Keeping old LSP connection as the new kernel uses the same langauge")}catch(e){console.warn(e),this.reloadConnection()}}dispose(){this.isDisposed||(this.widget.context.sessionContext.kernelChanged.disconnect(this.onKernelChanged,this),this.widget.content.activeCellChanged.disconnect(this._activeCellChanged,this),super.dispose(),this._editorToCell.clear(),s.Signal.clearData(this))}isReady(){var e;return!this.widget.isDisposed&&this.widget.context.isReady&&this.widget.content.isVisible&&this.widget.content.widgets.length>0&&null!=(null===(e=this.widget.context.sessionContext.session)||void 0===e?void 0:e.kernel)}async handleCellChange(e,t){let n=[],i=[];const s=this._type;if("set"===t.type){let e=[],o=[];if(t.newValues.length===t.oldValues.length){for(let n=0;n<t.newValues.length;n++)t.oldValues[n].type===s&&t.newValues[n].type!==s?e.push(t.newValues[n]):t.oldValues[n].type!==s&&t.newValues[n].type===s&&o.push(t.newValues[n]);n=o,i=e}}else"add"==t.type&&(n=t.newValues.filter((e=>e.type===s)));(i.length||n.length||"set"===t.type||"move"===t.type||"remove"===t.type)&&await this.updateDocuments();for(let e of n){let t=this.widget.content.widgets.find((t=>t.model.id===e.id));t?this._getCellEditor(t):console.warn(`Widget for added cell with ID: ${e.id} not found!`)}}createVirtualDocument(){return new ke.lr({language:this.language,foreignCodeExtractors:this.options.foreignCodeExtractorsManager,path:this.documentPath,fileExtension:this.languageFileExtension,standalone:!1,hasLspSupportedFile:!1})}language_info(){return this._languageInfo}async initOnceReady(){await(0,xe.TS)(this.isReady.bind(this),-1),await this._updateLanguageInfo(),this.initVirtual(),this.connectDocument(this.virtualDocument,!1).catch(console.warn),this.widget.context.sessionContext.kernelChanged.connect(this.onKernelChanged,this),this.widget.content.activeCellChanged.connect(this._activeCellChanged,this),this._connectModelSignals(this.widget),this.editor.modelChanged.connect((e=>{console.warn("Model changed, connecting cell change handler; this is not something we were expecting"),this._connectModelSignals(e)}))}_connectModelSignals(e){null===e.model?console.warn(`Model is missing for notebook ${e}, cannot connect cell changed signal!`):e.model.cells.changed.connect(this.handleCellChange,this)}async _updateLanguageInfo(){var e,t,n,i;const s=null===(i=await(null===(n=null===(t=null===(e=this.widget.context.sessionContext)||void 0===e?void 0:e.session)||void 0===t?void 0:t.kernel)||void 0===n?void 0:n.info))||void 0===i?void 0:i.language_info;if(!s)throw new Error("Language info update failed (no session, kernel, or info available)");this._languageInfo=s}_activeCellChanged(e,t){t&&t.model.type===this._type&&this._activeEditorChanged.emit({editor:this._getCellEditor(t)})}_getCellAt(e){let t=this.virtualDocument.getEditorAtVirtualLine(e);return this._editorToCell.get(t)}_getCellEditor(e){if(!this._cellToEditor.has(e)){const t=Object.freeze({getEditor:()=>e.editor,ready:async()=>(await e.ready,e.editor),reveal:async()=>(await this.editor.scrollToCell(e),e.editor)});this._cellToEditor.set(e,t),this._editorToCell.set(t,e),e.disposed.connect((()=>{this._cellToEditor.delete(e),this._editorToCell.delete(t),this._editorRemoved.emit({editor:t})})),this._editorAdded.emit({editor:t})}return this._cellToEditor.get(e)}}const Me="jp-mod-error";class Ie extends A.Widget{constructor(e){super(),this._dataDirty=!1,this._inputDirty=!1,this._source=null,this._originalValue=S.JSONExt.emptyObject,this._changeGuard=!1,this.translator=e.translator||x.nullTranslator,this._trans=this.translator.load("jupyterlab"),this.addClass("jp-JSONEditor"),this.headerNode=document.createElement("div"),this.headerNode.className="jp-JSONEditor-header",this.revertButtonNode=k.undoIcon.element({tag:"span",title:this._trans.__("Revert changes to data")}),this.commitButtonNode=k.checkIcon.element({tag:"span",title:this._trans.__("Commit changes to data"),marginLeft:"8px"}),this.editorHostNode=document.createElement("div"),this.editorHostNode.className="jp-JSONEditor-host",this.headerNode.appendChild(this.revertButtonNode),this.headerNode.appendChild(this.commitButtonNode),this.node.appendChild(this.headerNode),this.node.appendChild(this.editorHostNode);const t=new r.p.Model({mimeType:"application/json"});t.sharedModel.changed.connect(this._onModelChanged,this),this.model=t,this.editor=e.editorFactory({host:this.editorHostNode,model:t,config:{readOnly:!0}})}get source(){return this._source}set source(e){this._source!==e&&(this._source&&this._source.changed.disconnect(this._onSourceChanged,this),this._source=e,this.editor.setOption("readOnly",null===e),e&&e.changed.connect(this._onSourceChanged,this),this._setValue())}get isDirty(){return this._dataDirty||this._inputDirty}dispose(){var e;this.isDisposed||(null===(e=this.source)||void 0===e||e.dispose(),this.model.dispose(),this.editor.dispose(),super.dispose())}handleEvent(e){switch(e.type){case"blur":this._evtBlur(e);break;case"click":this._evtClick(e)}}onAfterAttach(e){const t=this.editorHostNode;t.addEventListener("blur",this,!0),t.addEventListener("click",this,!0),this.revertButtonNode.hidden=!0,this.commitButtonNode.hidden=!0,this.headerNode.addEventListener("click",this)}onBeforeDetach(e){const t=this.editorHostNode;t.removeEventListener("blur",this,!0),t.removeEventListener("click",this,!0),this.headerNode.removeEventListener("click",this)}_onSourceChanged(e,t){this._changeGuard||(this._inputDirty||this.editor.hasFocus()?this._dataDirty=!0:this._setValue())}_onModelChanged(e,t){if(t.sourceChange){let e=!0;try{const e=JSON.parse(this.editor.model.sharedModel.getSource());this.removeClass(Me),this._inputDirty=!this._changeGuard&&!S.JSONExt.deepEqual(e,this._originalValue)}catch(t){this.addClass(Me),this._inputDirty=!0,e=!1}this.revertButtonNode.hidden=!this._inputDirty,this.commitButtonNode.hidden=!e||!this._inputDirty}}_evtBlur(e){!this._inputDirty&&this._dataDirty&&this._setValue()}_evtClick(e){const t=e.target;this.revertButtonNode.contains(t)?this._setValue():this.commitButtonNode.contains(t)?this.commitButtonNode.hidden||this.hasClass(Me)||(this._changeGuard=!0,this._mergeContent(),this._changeGuard=!1,this._setValue()):this.editorHostNode.contains(t)&&this.editor.focus()}_mergeContent(){const e=this.editor.model,t=this._originalValue,n=JSON.parse(e.sharedModel.getSource()),i=this.source;if(i){for(const e in n)S.JSONExt.deepEqual(n[e],t[e]||null)||i.set(e,n[e]);for(const e in t)e in n||i.delete(e)}}_setValue(){this._dataDirty=!1,this._inputDirty=!1,this.revertButtonNode.hidden=!0,this.commitButtonNode.hidden=!0,this.removeClass(Me);const e=this.editor.model,t=this._source?this._source.toJSON():{};if(this._changeGuard=!0,void 0===t)e.sharedModel.setSource(this._trans.__("No data!")),this._originalValue=S.JSONExt.emptyObject;else{const n=JSON.stringify(t,null,4);e.sharedModel.setSource(n),this._originalValue=t,n.length>1&&"{"===n[0]&&this.editor.setCursorPosition({line:0,column:1})}this._changeGuard=!1,this.commitButtonNode.hidden=!0,this.revertButtonNode.hidden=!0}}class Ee extends A.Widget{constructor(){super(),this._items=[],this.layout=new A.PanelLayout,this.addClass("jp-RankedPanel")}addWidget(e,t){const n={widget:e,rank:t},i=M.ArrayExt.upperBound(this._items,n,Pe.itemCmp);M.ArrayExt.insert(this._items,i,n),this.layout.insertWidget(i,e)}onChildRemoved(e){const t=M.ArrayExt.findFirstIndex(this._items,(t=>t.widget===e.child));-1!==t&&M.ArrayExt.removeAt(this._items,t)}}class Ae extends A.Widget{constructor(e){super(),this.addClass("jp-NotebookTools"),this.translator=e.translator||x.nullTranslator,this._tools=[],this.layout=new A.PanelLayout,this._tracker=e.tracker,this._tracker.currentChanged.connect(this._onActiveNotebookPanelChanged,this),this._tracker.activeCellChanged.connect(this._onActiveCellChanged,this),this._tracker.selectionChanged.connect(this._onSelectionChanged,this),this._onActiveNotebookPanelChanged(),this._onActiveCellChanged(),this._onSelectionChanged()}get activeCell(){return this._tracker.activeCell}get selectedCells(){const e=this._tracker.currentWidget;if(!e)return[];const t=e.content;return t.widgets.filter((e=>t.isSelectedOrActive(e)))}get activeNotebookPanel(){return this._tracker.currentWidget}addItem(e){var t;const n=e.tool,i=null!==(t=e.rank)&&void 0!==t?t:100;let s;const o=this._tools.find((t=>t.section===e.section));if(!o)throw new Error(`The section ${e.section} does not exist`);s=o.panel,n.addClass("jp-NotebookTools-tool"),s.addWidget(n,i),n.notebookTools=this,I.MessageLoop.sendMessage(n,Ae.ActiveNotebookPanelMessage),I.MessageLoop.sendMessage(n,Ae.ActiveCellMessage)}addSection(e){var t;const n=e.sectionName,i=e.label||e.sectionName,s=e.tool;let o=null!==(t=e.rank)&&void 0!==t?t:null;const a=new Ee;if(a.title.label=i,s&&a.addWidget(s,0),this._tools.push({section:n,panel:a,rank:o}),null!=o)this.layout.insertWidget(o,new k.Collapser({widget:a}));else{let e=null;const t=this.layout;for(let n=0;n<t.widgets.length;n++){let i=t.widgets[n];if(i instanceof k.Collapser&&"advancedToolsSection"===i.widget.id){e=n;break}}null!==e?this.layout.insertWidget(e,new k.Collapser({widget:a})):this.layout.addWidget(new k.Collapser({widget:a}))}}_onActiveNotebookPanelChanged(){this._prevActiveNotebookModel&&!this._prevActiveNotebookModel.isDisposed&&this._prevActiveNotebookModel.metadataChanged.disconnect(this._onActiveNotebookPanelMetadataChanged,this);const e=this.activeNotebookPanel&&this.activeNotebookPanel.content?this.activeNotebookPanel.content.model:null;this._prevActiveNotebookModel=e,e&&e.metadataChanged.connect(this._onActiveNotebookPanelMetadataChanged,this);for(const e of this._toolChildren())I.MessageLoop.sendMessage(e,Ae.ActiveNotebookPanelMessage)}_onActiveCellChanged(){this._prevActiveCell&&!this._prevActiveCell.isDisposed&&this._prevActiveCell.metadataChanged.disconnect(this._onActiveCellMetadataChanged,this);const e=this.activeCell?this.activeCell.model:null;this._prevActiveCell=e,e&&e.metadataChanged.connect(this._onActiveCellMetadataChanged,this);for(const e of this._toolChildren())I.MessageLoop.sendMessage(e,Ae.ActiveCellMessage)}_onSelectionChanged(){for(const e of this._toolChildren())I.MessageLoop.sendMessage(e,Ae.SelectionMessage)}_onActiveNotebookPanelMetadataChanged(e,t){const n=new o.ObservableJSON.ChangeMessage("activenotebookpanel-metadata-changed",{oldValue:void 0,newValue:void 0,...t});for(const e of this._toolChildren())I.MessageLoop.sendMessage(e,n)}_onActiveCellMetadataChanged(e,t){const n=new o.ObservableJSON.ChangeMessage("activecell-metadata-changed",{newValue:void 0,oldValue:void 0,...t});for(const e of this._toolChildren())I.MessageLoop.sendMessage(e,n)}*_toolChildren(){for(let e of this._tools)yield*e.panel.children()}}var Pe;!function(e){e.ActiveNotebookPanelMessage=new I.ConflatableMessage("activenotebookpanel-changed"),e.ActiveCellMessage=new I.ConflatableMessage("activecell-changed"),e.SelectionMessage=new I.ConflatableMessage("selection-changed");class t extends A.Widget{dispose(){super.dispose(),this.notebookTools&&(this.notebookTools=null)}processMessage(e){switch(super.processMessage(e),e.type){case"activenotebookpanel-changed":this.onActiveNotebookPanelChanged(e);break;case"activecell-changed":this.onActiveCellChanged(e);break;case"selection-changed":this.onSelectionChanged(e);break;case"activecell-metadata-changed":this.onActiveCellMetadataChanged(e);break;case"activenotebookpanel-metadata-changed":this.onActiveNotebookPanelMetadataChanged(e)}}onActiveNotebookPanelChanged(e){}onActiveCellChanged(e){}onSelectionChanged(e){}onActiveCellMetadataChanged(e){}onActiveNotebookPanelMetadataChanged(e){}}e.Tool=t,e.MetadataEditorTool=class extends t{constructor(e){super();const{editorFactory:t}=e;this.addClass("jp-MetadataEditorTool");const n=this.layout=new A.PanelLayout;this._editorFactory=t,this._editorLabel=e.label||"Edit Metadata",this.createEditor();const i=new A.Widget({node:document.createElement("label")});i.node.textContent=e.label||"Edit Metadata",n.addWidget(i),n.addWidget(this.editor)}get editor(){return this._editor}onActiveNotebookPanelChanged(e){this.editor.dispose(),this.notebookTools.activeNotebookPanel&&this.createEditor()}createEditor(){this._editor=new Ie({editorFactory:this._editorFactory}),this.editor.title.label=this._editorLabel,this.layout.addWidget(this.editor)}}}(Ae||(Ae={})),function(e){e.itemCmp=function(e,t){return e.rank-t.rank}}(Pe||(Pe={}));var Ne=n(61879),De=n(38809),Te=n(99969),Oe=n(91238);const Le="jp-mod-dropTarget",He="jp-mod-dropSource";class Re extends k.WindowedListModel{constructor(e,t){super(t),this.cells=e,this.estimateWidgetSize=e=>{const t=this.cells[e].model.sharedModel.getSource().split("\n").length;return Re.DEFAULT_EDITOR_LINE_HEIGHT*t+Re.DEFAULT_CELL_MARGIN},this.widgetRenderer=e=>this.cells[e],this._estimatedWidgetSize=Re.DEFAULT_CELL_SIZE}}Re.DEFAULT_CELL_SIZE=39,Re.DEFAULT_EDITOR_LINE_HEIGHT=17,Re.DEFAULT_CELL_MARGIN=22;class Fe extends k.WindowedLayout{constructor(){super(...arguments),this._header=null,this._footer=null,this._willBeRemoved=null,this._topHiddenCodeCells=-1}get header(){return this._header}set header(e){var t;this._header&&this._header.isAttached&&A.Widget.detach(this._header),this._header=e,this._header&&(null===(t=this.parent)||void 0===t?void 0:t.isAttached)&&A.Widget.attach(this._header,this.parent.node)}get footer(){return this._footer}set footer(e){var t;this._footer&&this._footer.isAttached&&A.Widget.detach(this._footer),this._footer=e,this._footer&&(null===(t=this.parent)||void 0===t?void 0:t.isAttached)&&A.Widget.attach(this._footer,this.parent.node)}dispose(){var e,t;this.isDisposed||(null===(e=this._header)||void 0===e||e.dispose(),null===(t=this._footer)||void 0===t||t.dispose(),super.dispose())}removeWidget(e){const t=this.widgets.indexOf(e);t>=0?this.removeWidgetAt(t):e===this._willBeRemoved&&this.parent&&this.detachWidget(t,e)}attachWidget(e,t){const n=t.isPlaceholder();if(this.parent.isAttached&&I.MessageLoop.sendMessage(t,A.Widget.Msg.BeforeAttach),!n&&t instanceof ne&&t.node.parentElement)t.node.style.display="",this._topHiddenCodeCells=-1;else{const e=this._findNearestChildBinarySearch(this.parent.viewportNode.childElementCount-1,0,parseInt(t.dataset.windowedListIndex,10)+1);let n=this.parent.viewportNode.children[e];this.parent.viewportNode.insertBefore(t.node,n),this.parent.isAttached&&I.MessageLoop.sendMessage(t,A.Widget.Msg.AfterAttach)}t.inViewport=!0}detachWidget(e,t){t.inViewport=!1,t instanceof ne&&!t.node.classList.contains(He)&&t!==this._willBeRemoved?(t.node.style.display="none",this._topHiddenCodeCells=-1):(this.parent.isAttached&&I.MessageLoop.sendMessage(t,A.Widget.Msg.BeforeDetach),this.parent.viewportNode.removeChild(t.node),t.node.classList.remove(Le)),this.parent.isAttached&&I.MessageLoop.sendMessage(t,A.Widget.Msg.AfterDetach)}moveWidget(e,t,n){if(this._topHiddenCodeCells<0){this._topHiddenCodeCells=0;for(let e=0;e<this.parent.viewportNode.children.length&&"none"==this.parent.viewportNode.children[e].style.display;e++)this._topHiddenCodeCells++}const i=this.parent.viewportNode.children[t+this._topHiddenCodeCells];e<t?i.insertAdjacentElement("afterend",n.node):i.insertAdjacentElement("beforebegin",n.node)}onAfterAttach(e){super.onAfterAttach(e),this._header&&!this._header.isAttached&&A.Widget.attach(this._header,this.parent.node,this.parent.node.firstElementChild),this._footer&&!this._footer.isAttached&&A.Widget.attach(this._footer,this.parent.node)}onBeforeDetach(e){var t,n;(null===(t=this._header)||void 0===t?void 0:t.isAttached)&&A.Widget.detach(this._header),(null===(n=this._footer)||void 0===n?void 0:n.isAttached)&&A.Widget.detach(this._footer),super.onBeforeDetach(e)}onChildRemoved(e){this._willBeRemoved=e.child,super.onChildRemoved(e),this._willBeRemoved=null}_findNearestChildBinarySearch(e,t,n){for(;t<=e;){const i=t+Math.floor((e-t)/2),s=parseInt(this.parent.viewportNode.children[i].dataset.windowedListIndex,10);if(s===n)return i;s<n?t=i+1:s>n&&(e=i-1)}return t>0?t:0}}class Be extends A.Widget{constructor(e){super({node:document.createElement("button")}),this.notebook=e;const t=e.translator.load("jupyterlab");this.addClass("jp-Notebook-footer"),this.node.innerText=t.__("Click to add a cell.")}handleEvent(e){switch(e.type){case"click":this.onClick();break;case"keydown":if("ArrowUp"===e.key){this.onArrowUp();break}}}onClick(){this.notebook.widgets.length>0&&(this.notebook.activeCellIndex=this.notebook.widgets.length-1),de.insertBelow(this.notebook)}onArrowUp(){this.node.blur(),this.notebook.mode="command"}onAfterAttach(e){super.onAfterAttach(e),this.node.addEventListener("click",this),this.node.addEventListener("keydown",this)}onBeforeDetach(e){this.node.removeEventListener("click",this),this.node.removeEventListener("keydown",this),super.onBeforeDetach(e)}}const je="jp-Notebook-cell",We="jp-mod-editMode",Ve="jp-mod-commandMode",Ue="jp-mod-active",Je="jp-mod-selected",ze="jp-mod-multiSelected",qe="jp-dragImage",$e="jp-dragImage-singlePrompt",Ke="jp-dragImage-content",Qe="jp-dragImage-prompt",Ge="jp-dragImage-multipleBack",Ye="application/vnd.jupyter.cells",Xe="jp-mod-sideBySide";void 0===window.requestIdleCallback&&(window.requestIdleCallback=function(e){let t=Date.now();return setTimeout((function(){e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-t))}})}),1)},window.cancelIdleCallback=function(e){clearTimeout(e)});class Ze extends k.WindowedList{constructor(e){var t,n,i,o,a;const l=new Array;super({model:new Re(l,{overscanCount:null!==(n=null===(t=e.notebookConfig)||void 0===t?void 0:t.overscanCount)&&void 0!==n?n:Ze.defaultNotebookConfig.overscanCount,windowingActive:"full"===(null!==(o=null===(i=e.notebookConfig)||void 0===i?void 0:i.windowingMode)&&void 0!==o?o:Ze.defaultNotebookConfig.windowingMode)}),layout:new Fe}),this._cellCollapsed=new s.Signal(this),this._cellInViewportChanged=new s.Signal(this),this._renderingLayoutChanged=new s.Signal(this),this.addClass("jp-Notebook"),this.cellsArray=l,this._idleCallBack=null,this._editorConfig=Ze.defaultEditorConfig,this._notebookConfig=Ze.defaultNotebookConfig,this._mimetype="text/plain",this._notebookModel=null,this._modelChanged=new s.Signal(this),this._modelContentChanged=new s.Signal(this),this.node.dataset.jpKernelUser="true",this.node.dataset.jpUndoer="true",this.node.dataset.jpCodeRunner="true",this.rendermime=e.rendermime,this.translator=e.translator||x.nullTranslator,this.contentFactory=e.contentFactory,this.editorConfig=e.editorConfig||Ze.defaultEditorConfig,this.notebookConfig=e.notebookConfig||Ze.defaultNotebookConfig,this._updateNotebookConfig(),this._mimetypeService=e.mimeTypeService,this.renderingLayout=null===(a=e.notebookConfig)||void 0===a?void 0:a.renderingLayout}get cellCollapsed(){return this._cellCollapsed}get cellInViewportChanged(){return this._cellInViewportChanged}get modelChanged(){return this._modelChanged}get modelContentChanged(){return this._modelContentChanged}get renderingLayoutChanged(){return this._renderingLayoutChanged}get model(){return this._notebookModel}set model(e){var t;if(e=e||null,this._notebookModel===e)return;const n=this._notebookModel;this._notebookModel=e,this._onModelChanged(n,e),this.onModelChanged(n,e),this._modelChanged.emit(void 0),this.viewModel.itemsList=null!==(t=null==e?void 0:e.cells)&&void 0!==t?t:null}get codeMimetype(){return this._mimetype}get widgets(){return this.cellsArray}get editorConfig(){return this._editorConfig}set editorConfig(e){this._editorConfig=e,this._updateEditorConfig()}get notebookConfig(){return this._notebookConfig}set notebookConfig(e){this._notebookConfig=e,this._updateNotebookConfig()}get renderingLayout(){return this._renderingLayout}set renderingLayout(e){var t;this._renderingLayout=e,"side-by-side"===this._renderingLayout?this.node.classList.add(Xe):this.node.classList.remove(Xe),this._renderingLayoutChanged.emit(null!==(t=this._renderingLayout)&&void 0!==t?t:"default")}dispose(){var e;this.isDisposed||(this._notebookModel=null,null===(e=this.layout.header)||void 0===e||e.dispose(),super.dispose())}moveCell(e,t,n=1){if(!this.model)return;const i=Math.min(this.model.cells.length-1,Math.max(0,t));if(i===e)return;const s=new Array(n);for(let t=0;t<n;t++){s[t]={};const n=this.widgets[e+t];if("markdown"===n.model.type)for(const e of["rendered","headingCollapsed"])s[t][e]=n[e]}this.model.sharedModel.moveCells(e,i,n);for(let e=0;e<n;e++){const n=this.widgets[t+e],i=s[e];for(const e in i)n[e]=i[e]}}renderCellOutputs(e){const t=this.viewModel.widgetRenderer(e);t instanceof ne&&t.isPlaceholder()&&(t.dataset.windowedListIndex=`${e}`,this.layout.insertWidget(e,t),"full"===this.notebookConfig.windowingMode&&requestAnimationFrame((()=>{this.layout.removeWidget(t)})))}addHeader(){const e=this.translator.load("jupyterlab"),t=new A.Widget;t.node.textContent=e.__("The notebook is empty. Click the + button on the toolbar to add a new cell."),this.layout.header=t}removeHeader(){var e;null===(e=this.layout.header)||void 0===e||e.dispose(),this.layout.header=null}onModelChanged(e,t){}onModelContentChanged(e,t){this._modelContentChanged.emit(void 0)}onMetadataChanged(e,t){"language_info"===t.key&&this._updateMimetype()}onCellInserted(e,t){}onCellRemoved(e,t){}onUpdateRequest(e){"defer"===this.notebookConfig.windowingMode?this._runOnIdleTime():super.onUpdateRequest(e)}_onModelChanged(e,t){var n;if(e)for(e.contentChanged.disconnect(this.onModelContentChanged,this),e.metadataChanged.disconnect(this.onMetadataChanged,this),e.cells.changed.disconnect(this._onCellsChanged,this);this.cellsArray.length;)this._removeCell(0);if(!t)return void(this._mimetype="text/plain");this._updateMimetype();const i=t.cells;null!==(n=t.collaborative)&&void 0!==n&&n||i.length||t.sharedModel.insertCell(0,{cell_type:this.notebookConfig.defaultCell,metadata:"code"===this.notebookConfig.defaultCell?{trusted:!0}:{}});let s=-1;for(const e of i)this._insertCell(++s,e);t.cells.changed.connect(this._onCellsChanged,this),t.metadataChanged.connect(this.onMetadataChanged,this),t.contentChanged.connect(this.onModelContentChanged,this)}_onCellsChanged(e,t){switch(this.removeHeader(),t.type){case"add":{let e=0;e=t.newIndex;for(const n of t.newValues)this._insertCell(e++,n);this._updateDataWindowedListIndex(t.newIndex,this.model.cells.length,t.newValues.length);break}case"remove":for(let e=t.oldValues.length;e>0;e--)this._removeCell(t.oldIndex);if(this._updateDataWindowedListIndex(t.oldIndex,this.model.cells.length+t.oldValues.length,-1*t.oldValues.length),!e.length){const e=this.model;requestAnimationFrame((()=>{!e||e.isDisposed||e.sharedModel.cells.length||e.sharedModel.insertCell(0,{cell_type:this.notebookConfig.defaultCell,metadata:"code"===this.notebookConfig.defaultCell?{trusted:!0}:{}})}))}break;default:return}this.model.sharedModel.cells.length||this.addHeader(),this.update()}_insertCell(e,t){let n;switch(t.type){case"code":n=this._createCodeCell(t),n.model.mimeType=this._mimetype;break;case"markdown":n=this._createMarkdownCell(t),""===t.sharedModel.getSource()&&(n.rendered=!1);break;default:n=this._createRawCell(t)}n.inViewportChanged.connect(this._onCellInViewportChanged,this),n.addClass(je),M.ArrayExt.insert(this.cellsArray,e,n),this.onCellInserted(e,n),this._scheduleCellRenderOnIdle()}_createCodeCell(e){const t=this.rendermime,n={contentFactory:this.contentFactory,editorConfig:this.editorConfig.code,inputHistoryScope:this.notebookConfig.inputHistoryScope,maxNumberOutputs:this.notebookConfig.maxNumberOutputs,model:e,placeholder:"none"!==this._notebookConfig.windowingMode,rendermime:t,translator:this.translator},i=this.contentFactory.createCodeCell(n);return i.syncCollapse=!0,i.syncEditable=!0,i.syncScrolled=!0,i.outputArea.inputRequested.connect((()=>{this._onInputRequested(i).catch((e=>{console.error("Failed to scroll to cell requesting input.",e)}))})),i}_createMarkdownCell(e){const t=this.rendermime,n={contentFactory:this.contentFactory,editorConfig:this.editorConfig.markdown,model:e,placeholder:"none"!==this._notebookConfig.windowingMode,rendermime:t,showEditorForReadOnlyMarkdown:this._notebookConfig.showEditorForReadOnlyMarkdown},i=this.contentFactory.createMarkdownCell(n);return i.syncCollapse=!0,i.syncEditable=!0,i.headingCollapsedChanged.connect(this._onCellCollapsed,this),i}_createRawCell(e){const t=this.contentFactory,n={editorConfig:this.editorConfig.raw,model:e,contentFactory:t,placeholder:"none"!==this._notebookConfig.windowingMode},i=this.contentFactory.createRawCell(n);return i.syncCollapse=!0,i.syncEditable=!0,i}_removeCell(e){const t=this.cellsArray[e];t.parent=null,M.ArrayExt.removeAt(this.cellsArray,e),this.onCellRemoved(e,t),t.dispose()}_updateMimetype(){var e;const t=null===(e=this._notebookModel)||void 0===e?void 0:e.getMetadata("language_info");if(t){this._mimetype=this._mimetypeService.getMimeTypeByLanguage(t);for(const e of this.widgets)"code"===e.model.type&&(e.model.mimeType=this._mimetype)}}_onCellCollapsed(e,t){de.setHeadingCollapse(e,t,this),this._cellCollapsed.emit(e)}_onCellInViewportChanged(e){this._cellInViewportChanged.emit(e)}async _onInputRequested(e){if(!e.inViewport){const t=this.widgets.findIndex((t=>t===e));if(t>=0){await this.scrollToItem(t);const n=e.node.querySelector(".jp-Stdin");n&&(P.TE.scrollIntoViewIfNeeded(this.node,n),n.focus())}}}_scheduleCellRenderOnIdle(){"none"===this.notebookConfig.windowingMode||this.isDisposed||this._idleCallBack||(this._idleCallBack=requestIdleCallback((e=>{this._idleCallBack=null,this._runOnIdleTime(e.didTimeout?50:e.timeRemaining())}),{timeout:3e3}))}_updateDataWindowedListIndex(e,t,n){for(let i=0;i<this.viewportNode.childElementCount;i++){const s=this.viewportNode.children[i],o=parseInt(s.dataset.windowedListIndex,10);o>=e&&o<t&&(s.dataset.windowedListIndex=`${o+n}`)}}_updateEditorConfig(){for(let e=0;e<this.widgets.length;e++){const t=this.widgets[e];let n={};switch(t.model.type){case"code":n=this._editorConfig.code;break;case"markdown":n=this._editorConfig.markdown;break;default:n=this._editorConfig.raw}t.updateEditorConfig({...n})}}async _runOnIdleTime(e=50){const t=Date.now();let n=0;for(;Date.now()-t<e&&n<this.cellsArray.length;){const e=this.cellsArray[n];if(e.isPlaceholder())switch(this.notebookConfig.windowingMode){case"defer":await this._updateForDeferMode(e,n);break;case"full":this._renderCSSAndJSOutputs(e,n)}n++}n<this.cellsArray.length?this._scheduleCellRenderOnIdle():this._idleCallBack&&(window.cancelIdleCallback(this._idleCallBack),this._idleCallBack=null)}async _updateForDeferMode(e,t){e.dataset.windowedListIndex=`${t}`,this.layout.insertWidget(t,e),await e.ready}_renderCSSAndJSOutputs(e,t){var n,i,s;if(e instanceof ne)for(let o=0;o<(null!==(i=null===(n=e.model.outputs)||void 0===n?void 0:n.length)&&void 0!==i?i:0);o++)if((null!==(s=e.model.outputs.get(o).data["text/html"])&&void 0!==s?s:"").match(/(<style[^>]*>[^<]*<\/style[^>]*>|<script[^>]*>.*?<\/script[^>]*>)/gims)){this.renderCellOutputs(t);break}}_updateNotebookConfig(){this.toggleClass("jp-mod-scrollPastEnd",this._notebookConfig.scrollPastEnd),this.toggleClass("jp-mod-showHiddenCellsButton",this._notebookConfig.showHiddenCellsButton);const e=this._notebookConfig.showEditorForReadOnlyMarkdown;if(void 0!==e)for(const t of this.cellsArray)"markdown"===t.model.type&&(t.showEditorForReadOnly=e);this.viewModel.windowingActive="full"===this._notebookConfig.windowingMode}}!function(e){e.defaultEditorConfig={code:{lineNumbers:!1,lineWrap:!1,matchBrackets:!0},markdown:{lineNumbers:!1,lineWrap:!0,matchBrackets:!1},raw:{lineNumbers:!1,lineWrap:!0,matchBrackets:!1}},e.defaultNotebookConfig={showHiddenCellsButton:!0,scrollPastEnd:!0,defaultCell:"code",recordTiming:!1,inputHistoryScope:"global",maxNumberOutputs:50,showEditorForReadOnlyMarkdown:!0,disableDocumentWideUndoRedo:!0,renderingLayout:"default",sideBySideLeftMarginOverride:"10px",sideBySideRightMarginOverride:"10px",sideBySideOutputRatio:1,overscanCount:1,windowingMode:"full"};class t extends ee.ContentFactory{createCodeCell(e){return new ne(e).initializeState()}createMarkdownCell(e){return new se(e).initializeState()}createRawCell(e){return new oe(e).initializeState()}}e.ContentFactory=t}(Ze||(Ze={}));class et extends Ze{constructor(e){super(e),this._activeCellIndex=-1,this._activeCell=null,this._mode="command",this._drag=null,this._dragData=null,this._mouseMode=null,this._activeCellChanged=new s.Signal(this),this._stateChanged=new s.Signal(this),this._selectionChanged=new s.Signal(this),this._checkCacheOnNextResize=!1,this._lastClipboardInteraction=null,this._selectedCells=[],this.node.tabIndex=0,this.node.setAttribute("data-lm-dragscroll","true"),this.activeCellChanged.connect(this._updateSelectedCells,this),this.selectionChanged.connect(this._updateSelectedCells,this),this.addFooter()}get selectedCells(){return this._selectedCells}addFooter(){const e=new Be(this);this.layout.footer=e}_onCellsChanged(e,t){var n,i;const s=null===(n=this.activeCell)||void 0===n?void 0:n.model.id;if(super._onCellsChanged(e,t),s){const e=null===(i=this.model)||void 0===i?void 0:i.sharedModel.cells.findIndex((e=>e.getId()===s));null!=e&&(this.activeCellIndex=e)}}get activeCellChanged(){return this._activeCellChanged}get stateChanged(){return this._stateChanged}get selectionChanged(){return this._selectionChanged}get mode(){return this._mode}set mode(e){const t=this.activeCell;if(t||(e="command"),e===this._mode)return void this._ensureFocus();this.update();const n=this._mode;if(this._mode=e,"edit"===e){for(const e of this.widgets)this.deselect(e);t instanceof se&&(t.rendered=!1),t.inputHidden=!1}else this.node.focus();this._stateChanged.emit({name:"mode",oldValue:n,newValue:e}),this._ensureFocus()}get activeCellIndex(){return this.model&&this.widgets.length?this._activeCellIndex:-1}set activeCellIndex(e){var t;const n=this._activeCellIndex;this.model&&this.widgets.length?(e=Math.max(e,0),e=Math.min(e,this.widgets.length-1)):e=-1,this._activeCellIndex=e;const i=null!==(t=this.widgets[e])&&void 0!==t?t:null,s=i!==this._activeCell;s&&(this.update(),this._activeCell=i),(s||e!=n)&&this._activeCellChanged.emit(i),"edit"===this.mode&&i instanceof se&&(i.rendered=!1),this._ensureFocus(),e!==n&&(this._trimSelections(),this._stateChanged.emit({name:"activeCellIndex",oldValue:n,newValue:e}))}get activeCell(){return this._activeCell}get lastClipboardInteraction(){return this._lastClipboardInteraction}set lastClipboardInteraction(e){this._lastClipboardInteraction=e}dispose(){this.isDisposed||(this._activeCell=null,super.dispose())}moveCell(e,t,n=1){const i=e<=this.activeCellIndex&&this.activeCellIndex<e+n?this.activeCellIndex+t-e-(e>t?0:n-1):-1,s=this.widgets.slice(e,e+n).map((e=>this.isSelected(e)));super.moveCell(e,t,n),i>=0&&(this.activeCellIndex=i),e>t?s.forEach(((e,n)=>{e&&this.select(this.widgets[t+n])})):s.forEach(((e,i)=>{e&&this.select(this.widgets[t-n+1+i])}))}select(e){tt.selectedProperty.get(e)||(tt.selectedProperty.set(e,!0),this._selectionChanged.emit(void 0),this.update())}deselect(e){tt.selectedProperty.get(e)&&(tt.selectedProperty.set(e,!1),this._selectionChanged.emit(void 0),this.update())}isSelected(e){return tt.selectedProperty.get(e)}isSelectedOrActive(e){return e===this._activeCell||tt.selectedProperty.get(e)}deselectAll(){let e=!1;for(const t of this.widgets)tt.selectedProperty.get(t)&&(e=!0),tt.selectedProperty.set(t,!1);e&&this._selectionChanged.emit(void 0),this.activeCellIndex=this.activeCellIndex,this.update()}extendContiguousSelectionTo(e){let t,{head:n,anchor:i}=this.getContiguousSelection();if(null===i||null===n){if(e===this.activeCellIndex)return;n=this.activeCellIndex,i=this.activeCellIndex}if(this.activeCellIndex=e,(e=this.activeCellIndex)===i)return void this.deselectAll();let s=!1;if(n<e)for(n<i&&(tt.selectedProperty.set(this.widgets[n],!1),s=!0),t=n+1;t<e;t++)t!==i&&(tt.selectedProperty.set(this.widgets[t],!tt.selectedProperty.get(this.widgets[t])),s=!0);else if(e<n)for(i<n&&(tt.selectedProperty.set(this.widgets[n],!1),s=!0),t=e+1;t<n;t++)t!==i&&(tt.selectedProperty.set(this.widgets[t],!tt.selectedProperty.get(this.widgets[t])),s=!0);tt.selectedProperty.get(this.widgets[i])||(s=!0),tt.selectedProperty.set(this.widgets[i],!0),tt.selectedProperty.get(this.widgets[e])||(s=!0),tt.selectedProperty.set(this.widgets[e],!0),s&&this._selectionChanged.emit(void 0)}getContiguousSelection(){const e=this.widgets,t=M.ArrayExt.findFirstIndex(e,(e=>this.isSelected(e)));if(-1===t)return{head:null,anchor:null};const n=M.ArrayExt.findLastIndex(e,(e=>this.isSelected(e)),-1,t);for(let i=t;i<=n;i++)if(!this.isSelected(e[i]))throw new Error("Selection not contiguous");const i=this.activeCellIndex;if(t!==i&&n!==i)throw new Error("Active cell not at endpoint of selection");return t===i?{head:t,anchor:n}:{head:n,anchor:t}}async scrollToCell(e,t="auto"){try{await this.scrollToItem(this.widgets.findIndex((t=>t===e)),t)}catch(e){}this.deselectAll(),this.select(e),e.activate()}_parseFragment(e){const t=e.slice(1);if(!t)return;const n=t.split("=");return 1===n.length?{kind:"heading",value:t}:{kind:n[0],value:n.slice(1).join("=")}}async setFragment(e){const t=this._parseFragment(e);if(!t)return;let n;switch(t.kind){case"heading":n=await this._findHeading(t.value);break;case"cell-id":n=this._findCellById(t.value);break;default:console.warn(`Unknown target type for URI fragment ${e}, interpreting as a heading`),n=await this._findHeading(t.kind+"="+t.value)}if(null==n)return;let{cell:i,element:s}=n;i.inViewport||await this.scrollToCell(i,"center"),null==s&&(s=i.node);const o=this.node.getBoundingClientRect(),a=s.getBoundingClientRect();(a.top>o.bottom||a.bottom<o.top)&&s.scrollIntoView({block:"center"})}handleEvent(e){if(this.model)switch(e.type){case"contextmenu":e.eventPhase===Event.CAPTURING_PHASE&&this._evtContextMenuCapture(e);break;case"mousedown":e.eventPhase===Event.CAPTURING_PHASE?this._evtMouseDownCapture(e):e.defaultPrevented||this._evtMouseDown(e);break;case"mouseup":e.currentTarget===document&&this._evtDocumentMouseup(e);break;case"mousemove":e.currentTarget===document&&this._evtDocumentMousemove(e);break;case"keydown":this._ensureFocus(!0);break;case"dblclick":this._evtDblClick(e);break;case"focusin":this._evtFocusIn(e);break;case"focusout":this._evtFocusOut(e);break;case"lm-dragenter":this._evtDragEnter(e);break;case"lm-dragleave":this._evtDragLeave(e);break;case"lm-dragover":this._evtDragOver(e);break;case"lm-drop":this._evtDrop(e);break;default:super.handleEvent(e)}}onAfterAttach(e){super.onAfterAttach(e);const t=this.node;t.addEventListener("contextmenu",this,!0),t.addEventListener("mousedown",this,!0),t.addEventListener("mousedown",this),t.addEventListener("keydown",this),t.addEventListener("dblclick",this),t.addEventListener("focusin",this),t.addEventListener("focusout",this),t.addEventListener("lm-dragenter",this,!0),t.addEventListener("lm-dragleave",this,!0),t.addEventListener("lm-dragover",this,!0),t.addEventListener("lm-drop",this,!0)}onBeforeDetach(e){const t=this.node;t.removeEventListener("contextmenu",this,!0),t.removeEventListener("mousedown",this,!0),t.removeEventListener("mousedown",this),t.removeEventListener("keydown",this),t.removeEventListener("dblclick",this),t.removeEventListener("focusin",this),t.removeEventListener("focusout",this),t.removeEventListener("lm-dragenter",this,!0),t.removeEventListener("lm-dragleave",this,!0),t.removeEventListener("lm-dragover",this,!0),t.removeEventListener("lm-drop",this,!0),document.removeEventListener("mousemove",this,!0),document.removeEventListener("mouseup",this,!0),super.onBeforeAttach(e)}onAfterShow(e){super.onAfterShow(e),this._checkCacheOnNextResize=!0}onResize(e){var t;if(!this._checkCacheOnNextResize)return super.onResize(e);super.onResize(e),this._checkCacheOnNextResize=!1;const n=this._cellLayoutStateCache,i=parseInt(this.node.style.width,10);if(!n||i!==n.width){this._cellLayoutStateCache={width:i};for(const e of this.widgets)e instanceof ee&&e.inViewport&&(null===(t=e.editorWidget)||void 0===t||t.update())}}onBeforeHide(e){super.onBeforeHide(e);const t=parseInt(this.node.style.width,10);this._cellLayoutStateCache={width:t}}onActivateRequest(e){super.onActivateRequest(e),this._ensureFocus(!0)}onUpdateRequest(e){super.onUpdateRequest(e);const t=this.activeCell;"edit"===this.mode?(this.addClass(We),this.removeClass(Ve)):(this.addClass(Ve),this.removeClass(We)),t&&t.addClass(Ue);let n=0;for(const e of this.widgets)e!==t&&e.removeClass(Ue),e.removeClass(ze),this.isSelectedOrActive(e)?(e.addClass(Je),n++):e.removeClass(Je);n>1&&(null==t||t.addClass(ze))}onCellInserted(e,t){t.ready.then((()=>{t.isDisposed||t.editor.edgeRequested.connect(this._onEdgeRequest,this)})),this.activeCellIndex=e<=this.activeCellIndex?this.activeCellIndex+1:this.activeCellIndex}onCellRemoved(e,t){this.activeCellIndex=e<=this.activeCellIndex?this.activeCellIndex-1:this.activeCellIndex,this.isSelected(t)&&this._selectionChanged.emit(void 0)}onModelChanged(e,t){super.onModelChanged(e,t),this.activeCellIndex=0}_onEdgeRequest(e,t){const n=this.activeCellIndex;if("top"===t){if(this.activeCellIndex--,this.activeCellIndex<n){const e=this.activeCell.editor;if(e){const t=e.lineCount-1;e.setCursorPosition({line:t,column:0})}}}else if("bottom"===t&&(this.activeCellIndex++,this.activeCellIndex>n)){const e=this.activeCell.editor;e&&e.setCursorPosition({line:0,column:0})}this.mode="edit"}_ensureFocus(e=!1){var t,n;const i=this.activeCell;"edit"===this.mode&&i&&!0!==(null===(t=i.editor)||void 0===t?void 0:t.hasFocus())&&(i.inViewport?null===(n=i.editor)||void 0===n||n.focus():this.scrollToItem(this.activeCellIndex).then((()=>{i.ready.then((()=>{var e;null===(e=i.editor)||void 0===e||e.focus()}))})).catch((e=>{}))),e&&!this.node.contains(document.activeElement)&&this.node.focus()}_findCell(e){let t=e;for(;t&&t!==this.node;){if(t.classList.contains(je)){const e=M.ArrayExt.findFirstIndex(this.widgets,(e=>e.node===t));if(-1!==e)return e;break}t=t.parentElement}return-1}_findEventTargetAndCell(e){let t=e.target,n=this._findCell(t);return-1===n&&(t=document.elementFromPoint(e.clientX,e.clientY),n=this._findCell(t)),[t,n]}async _findHeading(e){for(let t=0;t<this.widgets.length;t++){const n=this.widgets[t];if("raw"!==n.model.type&&("markdown"!==n.model.type||n.rendered))for(const t of n.headings){let i="";switch(t.type){case ee.HeadingType.HTML:i=t.id;break;case ee.HeadingType.Markdown:{const e=t;i=await y.N4(this.rendermime.markdownParser,e.raw,e.level)}}if(i===e)return{cell:n,element:this.node.querySelector(`h${t.level}[id="${i}"]`)}}}return null}_findCellById(e){for(let t=0;t<this.widgets.length;t++){const n=this.widgets[t];if(n.model.id===e)return{cell:n}}return null}_evtContextMenuCapture(e){var t;if(e.shiftKey)return;const[n,i]=this._findEventTargetAndCell(e),s=this.widgets[i];s&&(null===(t=s.editorWidget)||void 0===t?void 0:t.node.contains(n))&&e.preventDefault()}_evtMouseDownCapture(e){var t;const{button:n,shiftKey:i}=e,[s,o]=this._findEventTargetAndCell(e),a=this.widgets[o];2===n&&!i&&a&&(null===(t=a.editorWidget)||void 0===t?void 0:t.node.contains(s))&&(this.mode="command",e.preventDefault())}_evtMouseDown(e){var t,n,i;const{button:s,shiftKey:o}=e;if(0!==s&&2!==s)return;if(o&&2===s)return;const[a,l]=this._findEventTargetAndCell(e),d=this.widgets[l];let r;if(r=d?(null===(t=d.editorWidget)||void 0===t?void 0:t.node.contains(a))?"input":(null===(n=d.promptNode)||void 0===n?void 0:n.contains(a))?"prompt":"cell":"notebook","input"!==r&&(this.mode="command"),"notebook"===r)this.deselectAll();else if("prompt"===r||"cell"===r){const t=""!==(null!==(i=window.getSelection())&&void 0!==i?i:"").toString();if(0!==s||!o||t||["INPUT","OPTION"].includes(a.tagName))0!==s||o?2===s&&(this.isSelectedOrActive(d)||(this.deselectAll(),this.activeCellIndex=l),e.preventDefault()):("prompt"===r&&(this._dragData={pressX:e.clientX,pressY:e.clientY,index:l},this._mouseMode="couldDrag",document.addEventListener("mouseup",this,!0),document.addEventListener("mousemove",this,!0),e.preventDefault()),this.isSelectedOrActive(d)||(this.deselectAll(),this.activeCellIndex=l));else{e.preventDefault();try{this.extendContiguousSelectionTo(l)}catch(e){return console.error(e),void this.deselectAll()}this._mouseMode="select",document.addEventListener("mouseup",this,!0),document.addEventListener("mousemove",this,!0)}}else"input"===r&&(2!==s||this.isSelectedOrActive(d)||(this.deselectAll(),this.activeCellIndex=l));this._ensureFocus(!0)}_evtDocumentMouseup(e){if(e.preventDefault(),e.stopPropagation(),document.removeEventListener("mousemove",this,!0),document.removeEventListener("mouseup",this,!0),"couldDrag"===this._mouseMode){const[,t]=this._findEventTargetAndCell(e);this.deselectAll(),this.activeCellIndex=t,this.activeCell.node.contains(document.activeElement)||this.node.focus()}this._mouseMode=null}_evtDocumentMousemove(e){switch(e.preventDefault(),e.stopPropagation(),this._mouseMode){case"select":{const t=e.target,n=this._findCell(t);-1!==n&&this.extendContiguousSelectionTo(n);break}case"couldDrag":{const t=this._dragData,n=Math.abs(e.clientX-t.pressX),i=Math.abs(e.clientY-t.pressY);(n>=5||i>=5)&&(this._mouseMode=null,this._startDrag(t.index,e.clientX,e.clientY));break}}}_evtDragEnter(e){if(!e.mimeData.hasData(Ye))return;e.preventDefault(),e.stopPropagation();const t=e.target,n=this._findCell(t);-1!==n&&this.cellsArray[n].node.classList.add(Le)}_evtDragLeave(e){if(!e.mimeData.hasData(Ye))return;e.preventDefault(),e.stopPropagation();const t=this.node.getElementsByClassName(Le);t.length&&t[0].classList.remove(Le)}_evtDragOver(e){if(!e.mimeData.hasData(Ye))return;e.preventDefault(),e.stopPropagation(),e.dropAction=e.proposedAction;const t=this.node.getElementsByClassName(Le);t.length&&t[0].classList.remove(Le);const n=e.target,i=this._findCell(n);-1!==i&&this.cellsArray[i].node.classList.add(Le)}_evtDrop(e){if(!e.mimeData.hasData(Ye))return;if(e.preventDefault(),e.stopPropagation(),"none"===e.proposedAction)return void(e.dropAction="none");let t=e.target;for(;t&&t.parentElement;){if(t.classList.contains(Le)){t.classList.remove(Le);break}t=t.parentElement}const n=this.model,i=e.source;if(i===this){e.dropAction="move";const n=e.mimeData.getData("internal:cells"),s=n[n.length-1];if(s instanceof se&&s.headingCollapsed){const e=de.findNextParentHeading(s,i);if(e>0){const t=(0,M.findIndex)(i.widgets,(e=>s.model.id===e.model.id));n.push(...i.widgets.slice(t+1,e))}}let o=M.ArrayExt.firstIndexOf(this.widgets,n[0]),a=this._findCell(t);if(-1!==a&&a>o?a-=1:-1===a&&(a=this.widgets.length-1),a>=o&&a<o+n.length)return;this.moveCell(o,a,n.length)}else{e.dropAction="copy";let i=this._findCell(t);-1===i&&(i=this.widgets.length);const s=i,o=e.mimeData.getData(Ye);n.sharedModel.insertCells(i,o),this.deselectAll(),this.activeCellIndex=s,this.extendContiguousSelectionTo(i-1)}}_startDrag(e,t,n){var i;const s=this.model.cells,o=[],a=[];let l=-1;for(const e of this.widgets){const t=s.get(++l);this.isSelectedOrActive(e)&&(e.addClass(He),o.push(t.toJSON()),a.push(e))}const d=this.activeCell;let r,h=null;if("code"===(null==d?void 0:d.model.type)){const e=d.model.executionCount;r=" ",e&&(r=e.toString())}else r="";h=tt.createDragImage(o.length,r,null!==(i=null==d?void 0:d.model.sharedModel.getSource().split("\n")[0].slice(0,26))&&void 0!==i?i:""),this._drag=new De.n({mimeData:new S.MimeData,dragImage:h,supportedActions:"copy-move",proposedAction:"copy",source:this}),this._drag.mimeData.setData(Ye,o),this._drag.mimeData.setData("internal:cells",a);const c=a.map((e=>e.model.sharedModel.getSource())).join("\n");this._drag.mimeData.setData("text/plain",c),document.removeEventListener("mousemove",this,!0),document.removeEventListener("mouseup",this,!0),this._mouseMode=null,this._drag.start(t,n).then((e=>{if(!this.isDisposed){this._drag=null;for(const e of a)e.removeClass(He)}}))}_evtFocusIn(e){var t;const n=e.target,i=this._findCell(n);if(-1!==i){const e=this.widgets[i];e.editorWidget&&!e.editorWidget.node.contains(n)&&(this.mode="command"),this.activeCellIndex=i;const s=null===(t=e.editorWidget)||void 0===t?void 0:t.node;(null==s?void 0:s.contains(n))&&(this.mode="edit"),this.activeCellIndex=i}else this.mode="command"}_evtFocusOut(e){var t;const n=e.relatedTarget;if(!n)return;const i=this._findCell(n);-1!==i&&(null===(t=this.widgets[i].editorWidget)||void 0===t?void 0:t.node.contains(n))||"command"!==this.mode&&(this.mode="command",n&&n.focus())}_evtDblClick(e){const t=this.model;if(!t)return;this.deselectAll();const[n,i]=this._findEventTargetAndCell(e);e.target.classList.contains("jp-collapseHeadingButton")||-1===i||(this.activeCellIndex=i,"markdown"===t.cells.get(i).type?this.widgets[i].rendered=!1:"img"===n.localName&&n.classList.toggle("jp-mod-unconfined"))}_trimSelections(){for(let e=0;e<this.widgets.length;e++)if(e!==this._activeCellIndex){const t=this.widgets[e];!t.model.isDisposed&&t.editor&&t.model.selections.delete(t.editor.uuid)}}_updateSelectedCells(){this._selectedCells=this.widgets.filter((e=>this.isSelectedOrActive(e)))}}var tt;!function(e){class t extends Ze.ContentFactory{}e.ContentFactory=t}(et||(et={})),function(e){e.selectedProperty=new Te.AttachedProperty({name:"selected",create:()=>!1});class t extends A.PanelLayout{onUpdateRequest(e){}}e.NotebookPanelLayout=t,e.createDragImage=function(e,t,n){return e>1?""!==t?Oe.VirtualDOM.realize(Oe.h.div(Oe.h.div({className:qe},Oe.h.span({className:Qe},"["+t+"]:"),Oe.h.span({className:Ke},n)),Oe.h.div({className:Ge},""))):Oe.VirtualDOM.realize(Oe.h.div(Oe.h.div({className:qe},Oe.h.span({className:Qe}),Oe.h.span({className:Ke},n)),Oe.h.div({className:Ge},""))):""!==t?Oe.VirtualDOM.realize(Oe.h.div(Oe.h.div({className:`${qe} ${$e}`},Oe.h.span({className:Qe},"["+t+"]:"),Oe.h.span({className:Ke},n)))):Oe.VirtualDOM.realize(Oe.h.div(Oe.h.div({className:`${qe} ${$e}`},Oe.h.span({className:Qe}),Oe.h.span({className:Ke},n))))}}(tt||(tt={}));class nt extends Ne.DocumentWidget{constructor(e){super(e),this._autorestarting=!1,this.translator=e.translator||x.nullTranslator,this._trans=this.translator.load("jupyterlab"),this.addClass("jp-NotebookPanel"),this.toolbar.addClass("jp-NotebookPanel-toolbar"),this.content.addClass("jp-NotebookPanel-notebook"),this.content.model=this.context.model,this.context.sessionContext.kernelChanged.connect(this._onKernelChanged,this),this.context.sessionContext.statusChanged.connect(this._onSessionStatusChanged,this),this.context.saveState.connect(this._onSave,this),this.revealed.then((()=>{if(!this.isDisposed&&1===this.content.widgets.length){const e=this.content.widgets[0].model;"code"===e.type&&""===e.sharedModel.getSource()&&(this.content.mode="edit")}}))}_onSave(e,t){if("started"===t&&this.model)for(const e of this.model.cells)if(g(e))for(const t of e.attachments.keys)e.sharedModel.getSource().includes(t)||e.attachments.remove(t)}get sessionContext(){return this.context.sessionContext}get model(){return this.content.model}setConfig(e){this.content.editorConfig=e.editorConfig,this.content.notebookConfig=e.notebookConfig;const t=this.context.sessionContext.kernelPreference;this.context.sessionContext.kernelPreference={...t,shutdownOnDispose:e.kernelShutdown,autoStartDefault:e.autoStartDefault}}setFragment(e){this.context.ready.then((()=>{this.content.setFragment(e)}))}dispose(){this.content.dispose(),super.dispose()}[i.Printing.symbol](){return async()=>{this.context.model.dirty&&!this.context.model.readOnly&&await this.context.save(),await i.Printing.printURL(w.PageConfig.getNBConvertURL({format:"html",download:!1,path:this.context.path}))}}onBeforeHide(e){super.onBeforeHide(e),this.content.isParentHidden=!0}onBeforeShow(e){this.content.isParentHidden=!1,super.onBeforeShow(e)}_onKernelChanged(e,t){if(!this.model||!t.newValue)return;const{newValue:n}=t;n.info.then((e=>{var t;this.model&&(null===(t=this.context.sessionContext.session)||void 0===t?void 0:t.kernel)===n&&this._updateLanguage(e.language_info)})),this._updateSpec(n)}_onSessionStatusChanged(e,t){var n;"autorestarting"!==t||this._autorestarting?"restarting"===t||(this._autorestarting=!1):((0,i.showDialog)({title:this._trans.__("Kernel Restarting"),body:this._trans.__("The kernel for %1 appears to have died. It will restart automatically.",null===(n=this.sessionContext.session)||void 0===n?void 0:n.path),buttons:[i.Dialog.okButton({label:this._trans.__("Ok")})]}),this._autorestarting=!0)}_updateLanguage(e){this.model.setMetadata("language_info",e)}async _updateSpec(e){const t=await e.spec;this.isDisposed||this.model.setMetadata("kernelspec",{name:e.name,display_name:null==t?void 0:t.display_name,language:null==t?void 0:t.language})}}!function(e){class t extends et.ContentFactory{createNotebook(e){return new et(e)}}e.ContentFactory=t,e.IContentFactory=new S.Token("@jupyterlab/notebook:IContentFactory","A factory object that creates new notebooks.\n    Use this if you want to create and host notebooks in your own UI elements.")}(nt||(nt={}));var it=n(19026),st=n(95274);class ot extends it.EditorSearchProvider{constructor(e){super(),this.cell=e,this.cell.inViewport||this.cell.editor||(0,w.signalToPromise)(e.inViewportChanged).then((([,e])=>{e&&this.cmHandler.setEditor(this.editor)}))}get editor(){return this.cell.editor}get model(){return this.cell.model}}class at extends ot{constructor(e){super(e),this.currentProviderIndex=-1,this.outputsProvider=[];const t=this.cell.outputArea;this._onOutputsChanged(t,t.widgets.length).catch((e=>{console.error("Failed to initialize search on cell outputs.",e)})),t.outputLengthChanged.connect(this._onOutputsChanged,this),t.disposed.connect((()=>{t.outputLengthChanged.disconnect(this._onOutputsChanged)}),this)}get matchesCount(){return this.isActive?super.matchesCount+this.outputsProvider.reduce(((e,t)=>{var n;return e+(null!==(n=t.matchesCount)&&void 0!==n?n:0)}),0):0}async clearHighlight(){await super.clearHighlight(),await Promise.all(this.outputsProvider.map((e=>e.clearHighlight())))}dispose(){this.isDisposed||(super.dispose(),this.outputsProvider.map((e=>{e.dispose()})),this.outputsProvider.length=0)}async highlightNext(e,t){if(0!==this.matchesCount&&this.isActive){if(-1===this.currentProviderIndex){const e=await super.highlightNext(!0,t);if(e)return this.currentIndex=this.cmHandler.currentIndex,e;this.currentProviderIndex=0}for(;this.currentProviderIndex<this.outputsProvider.length;){const e=this.outputsProvider[this.currentProviderIndex],t=await e.highlightNext(!1);if(t)return this.currentIndex=super.matchesCount+this.outputsProvider.slice(0,this.currentProviderIndex).reduce(((e,t)=>{var n;return e+(null!==(n=t.matchesCount)&&void 0!==n?n:0)}),0)+e.currentMatchIndex,t;this.currentProviderIndex+=1}return this.currentProviderIndex=-1,void(this.currentIndex=null)}this.currentIndex=null}async highlightPrevious(){if(0!==this.matchesCount&&this.isActive){for(null===this.currentIndex&&(this.currentProviderIndex=this.outputsProvider.length-1);this.currentProviderIndex>=0;){const e=this.outputsProvider[this.currentProviderIndex],t=await e.highlightPrevious(!1);if(t)return this.currentIndex=super.matchesCount+this.outputsProvider.slice(0,this.currentProviderIndex).reduce(((e,t)=>{var n;return e+(null!==(n=t.matchesCount)&&void 0!==n?n:0)}),0)+e.currentMatchIndex,t;this.currentProviderIndex-=1}const e=await super.highlightPrevious();return e?(this.currentIndex=this.cmHandler.currentIndex,e):void(this.currentIndex=null)}this.currentIndex=null}async startQuery(e,t){await super.startQuery(e,t),!1!==(null==t?void 0:t.output)&&this.isActive&&await Promise.all(this.outputsProvider.map((t=>t.startQuery(e))))}async endQuery(){var e;await super.endQuery(),!1!==(null===(e=this.filters)||void 0===e?void 0:e.output)&&this.isActive&&await Promise.all(this.outputsProvider.map((e=>e.endQuery())))}async _onOutputsChanged(e,t){var n;this.outputsProvider.forEach((e=>{e.dispose()})),this.outputsProvider.length=0,this.currentProviderIndex=-1,this.outputsProvider=this.cell.outputArea.widgets.map((e=>new st.$C(e))),this.isActive&&this.query&&!1!==(null===(n=this.filters)||void 0===n?void 0:n.output)&&await Promise.all([this.outputsProvider.map((e=>{e.startQuery(this.query)}))]),this._stateChanged.emit()}}class lt extends ot{constructor(e){super(e),this._unrenderedByHighligh=!1,this.renderedProvider=new st.$C(e.renderer)}async clearHighlight(){await super.clearHighlight(),await this.renderedProvider.clearHighlight()}dispose(){this.isDisposed||(super.dispose(),this.renderedProvider.dispose())}async endQuery(){await super.endQuery(),await this.renderedProvider.endQuery()}async highlightNext(){let e;if(!this.isActive)return e;const t=this.cell;if(t.rendered&&this.matchesCount>0){this._unrenderedByHighligh=!0;const e=(0,w.signalToPromise)(t.renderedChanged);t.rendered=!1,await e}return e=await super.highlightNext(),e}async highlightPrevious(){let e;const t=this.cell;if(t.rendered&&this.matchesCount>0){this._unrenderedByHighligh=!0;const e=(0,w.signalToPromise)(t.renderedChanged);t.rendered=!1,await e}return e=await super.highlightPrevious(),e}async startQuery(e,t){await super.startQuery(e,t);const n=this.cell;n.rendered&&this.onRenderedChanged(n,n.rendered),n.renderedChanged.connect(this.onRenderedChanged,this)}async replaceAllMatches(e){const t=await super.replaceAllMatches(e);return this.cell.rendered&&this.cell.update(),t}onRenderedChanged(e,t){var n;this._unrenderedByHighligh||(this.currentIndex=null),this._unrenderedByHighligh=!1,this.isActive&&(t?this.renderedProvider.startQuery(this.query):(null===(n=e.editor)||void 0===n||n.setCursorPosition({column:0,line:0}),this.renderedProvider.endQuery()))}}function dt(e){if(e.isPlaceholder())return new ot(e);switch(e.model.type){case"code":return new at(e);case"markdown":return new lt(e);default:return new ot(e)}}var rt=n(32322);class ht extends rt.X{constructor(e,t=x.nullTranslator){super(e),this.translator=t,this._textSelection=null,this._currentProviderIndex=null,this._delayedActiveCellChangeHandler=null,this._onSelection=!1,this._selectedCells=1,this._selectedLines=0,this._query=null,this._searchProviders=[],this._editorSelectionsObservable=null,this._selectionSearchMode="cells",this._selectionLock=!1,this._handleHighlightsAfterActiveCellChange=this._handleHighlightsAfterActiveCellChange.bind(this),this.widget.model.cells.changed.connect(this._onCellsChanged,this),this.widget.content.activeCellChanged.connect(this._onActiveCellChanged,this),this.widget.content.selectionChanged.connect(this._onCellSelectionChanged,this),this.widget.content.stateChanged.connect(this._onNotebookStateChanged,this),this._observeActiveCell(),this._filtersChanged.connect(this._setEnginesSelectionSearchMode,this)}_onNotebookStateChanged(e,t){"mode"===t.name&&window.setTimeout((()=>{var e;"command"===t.newValue&&(null===(e=document.activeElement)||void 0===e?void 0:e.closest(".jp-DocumentSearch-overlay"))||(this._updateSelectionMode(),this._filtersChanged.emit())}),0)}static isApplicable(e){return e instanceof nt}static createNew(e,t){return new ht(e,t)}get currentMatchIndex(){let e=0,t=!1;for(let n=0;n<this._searchProviders.length;n++){const i=this._searchProviders[n];if(this._currentProviderIndex==n){const n=i.currentMatchIndex;if(null===n)return null;e+=n,t=!0;break}e+=i.matchesCount}return t?e:null}get matchesCount(){return this._searchProviders.reduce(((e,t)=>e+t.matchesCount),0)}get isReadOnly(){var e,t,n;return null!==(n=null===(t=null===(e=this.widget)||void 0===e?void 0:e.content.model)||void 0===t?void 0:t.readOnly)&&void 0!==n&&n}get replaceOptionsSupport(){return{preserveCase:!0}}dispose(){var e;if(this.isDisposed)return;this.widget.content.activeCellChanged.disconnect(this._onActiveCellChanged,this),null===(e=this.widget.model)||void 0===e||e.cells.changed.disconnect(this._onCellsChanged,this),this.widget.content.stateChanged.disconnect(this._onNotebookStateChanged,this),this.widget.content.selectionChanged.disconnect(this._onCellSelectionChanged,this),this._stopObservingLastCell(),super.dispose();const t=this.widget.content.activeCellIndex;this.endQuery().then((()=>{this.widget.isDisposed||(this.widget.content.activeCellIndex=t)})).catch((e=>{console.error(`Fail to end search query in notebook:\n${e}`)}))}getFilters(){const e=this.translator.load("jupyterlab");return{output:{title:e.__("Search Cell Outputs"),description:e.__("Search in the cell outputs."),default:!1,supportReplace:!1},selection:{title:"cells"===this._selectionSearchMode?e._n("Search in %1 Selected Cell","Search in %1 Selected Cells",this._selectedCells):e._n("Search in %1 Selected Line","Search in %1 Selected Lines",this._selectedLines),description:e.__("Search only in the selected cells or text (depending on edit/command mode)."),default:!1,supportReplace:!0}}}_updateSelectionMode(){this._selectionLock||(this._selectionSearchMode=1===this._selectedCells&&"edit"===this.widget.content.mode&&0!==this._selectedLines?"text":"cells")}getInitialQuery(){const e=this.widget.content.activeCell,t=null==e?void 0:e.editor;return t?t.state.sliceDoc(t.state.selection.main.from,t.state.selection.main.to):""}async clearHighlight(){this._selectionLock=!0,null!==this._currentProviderIndex&&this._currentProviderIndex<this._searchProviders.length&&(await this._searchProviders[this._currentProviderIndex].clearHighlight(),this._currentProviderIndex=null),this._selectionLock=!1}async highlightNext(e=!0,t){const n=await this._stepNext(!1,e,t);return null!=n?n:void 0}async highlightPrevious(e=!0,t){const n=await this._stepNext(!0,e,t);return null!=n?n:void 0}async startQuery(e,t){if(!this.widget)return;await this.endQuery();let n=this.widget.content.widgets;this._query=e,this._filters={output:!1,selection:!1,...null!=t?t:{}},this._onSelection=this._filters.selection;const i=this.widget.content.activeCellIndex;return this._searchProviders=await Promise.all(n.map((async(t,n)=>{const s=dt(t);return await s.setIsActive(!this._filters.selection||this.widget.content.isSelectedOrActive(t)),this._onSelection&&"text"===this._selectionSearchMode&&n===i&&this._textSelection&&await s.setSearchSelection(this._textSelection),await s.startQuery(e,this._filters),s}))),this._currentProviderIndex=i,await this.highlightNext(!0,{from:"selection-start",scroll:!1,select:!1}),Promise.resolve()}async endQuery(){await Promise.all(this._searchProviders.map((e=>e.endQuery().then((()=>{e.dispose()}))))),this._searchProviders.length=0,this._currentProviderIndex=null}async replaceCurrentMatch(e,t=!0,n){let i=!1;const s=async(e=!1)=>{var n;const i=null===(n=this.widget)||void 0===n?void 0:n.content.activeCell;"markdown"===(null==i?void 0:i.model.type)&&i.rendered&&(i.rendered=!1,e&&await this.highlightNext(t))};if(null!==this._currentProviderIndex){await s();const o=this._searchProviders[this._currentProviderIndex];i=await o.replaceCurrentMatch(e,!1,n),null===o.currentMatchIndex&&await this.highlightNext(t)}return await s(!0),i}async replaceAllMatches(e,t){return(await Promise.all(this._searchProviders.map((n=>n.replaceAllMatches(e,t))))).includes(!0)}async validateFilter(e,t){if("output"!==e)return t;if(t&&this.widget.content.widgets.some((e=>e instanceof ne&&e.isPlaceholder()))){const e=this.translator.load("jupyterlab");if(!(await(0,i.showDialog)({title:e.__("Confirmation"),body:e.__("Searching outputs is expensive and requires to first rendered all outputs. Are you sure you want to search in the cell outputs?"),buttons:[i.Dialog.cancelButton({label:e.__("Cancel")}),i.Dialog.okButton({label:e.__("Ok")})]})).button.accept)return!1;this.widget.content.widgets.forEach(((e,t)=>{e instanceof ne&&e.isPlaceholder()&&this.widget.content.renderCellOutputs(t)}))}return t}_addCellProvider(e){var t,n;const i=this.widget.content.widgets[e],s=dt(i);M.ArrayExt.insert(this._searchProviders,e,s),s.setIsActive(!(null!==(n=null===(t=this._filters)||void 0===t?void 0:t.selection)&&void 0!==n&&n)||this.widget.content.isSelectedOrActive(i)).then((()=>{s.startQuery(this._query,this._filters)}))}_removeCellProvider(e){const t=M.ArrayExt.removeAt(this._searchProviders,e);null==t||t.dispose()}async _onCellsChanged(e,t){switch(t.type){case"add":t.newValues.forEach(((e,n)=>{this._addCellProvider(t.newIndex+n)}));break;case"move":M.ArrayExt.move(this._searchProviders,t.oldIndex,t.newIndex);break;case"remove":for(let e=0;e<t.oldValues.length;e++)this._removeCellProvider(t.oldIndex);break;case"set":t.newValues.forEach(((e,n)=>{this._addCellProvider(t.newIndex+n),this._removeCellProvider(t.newIndex+n+1)}))}this._stateChanged.emit()}async _stepNext(e=!1,t=!1,n){const i=async e=>{var t;if(null!==(t=null==n?void 0:n.scroll)&&void 0!==t&&!t)return;if(this._selectionLock=!0,this.widget.content.activeCellIndex!==this._currentProviderIndex&&(this.widget.content.activeCellIndex=this._currentProviderIndex),-1===this.widget.content.activeCellIndex)return console.warn("No active cell (no cells or no model), aborting search"),void(this._selectionLock=!1);const i=this.widget.content.activeCell;if(!i.inViewport)try{await this.widget.content.scrollToItem(this._currentProviderIndex)}catch(e){}if(i.inputHidden&&(i.inputHidden=!1),!i.inViewport)return void(this._selectionLock=!1);await i.ready;const s=i.editor;s.revealPosition(s.getPositionAt(e.position)),this._selectionLock=!1};null===this._currentProviderIndex&&(this._currentProviderIndex=this.widget.content.activeCellIndex),e&&"command"===this.widget.content.mode&&(this._searchProviders[this._currentProviderIndex].getCurrentMatch()||(this._currentProviderIndex-=1),t&&(this._currentProviderIndex=(this._currentProviderIndex+this._searchProviders.length)%this._searchProviders.length));const s=this._currentProviderIndex;do{const s=this._searchProviders[this._currentProviderIndex],o=e?await s.highlightPrevious(!1,n):await s.highlightNext(!1,n);if(o)return await i(o),o;this._currentProviderIndex=this._currentProviderIndex+(e?-1:1),t&&(this._currentProviderIndex=(this._currentProviderIndex+this._searchProviders.length)%this._searchProviders.length)}while(t?this._currentProviderIndex!==s:0<=this._currentProviderIndex&&this._currentProviderIndex<this._searchProviders.length);if(t){const t=this._searchProviders[s],o=e?await t.highlightPrevious(!1,n):await t.highlightNext(!1,n);if(o)return await i(o),o}return this._currentProviderIndex=null,null}async _onActiveCellChanged(){null!==this._delayedActiveCellChangeHandler&&(clearTimeout(this._delayedActiveCellChangeHandler),this._delayedActiveCellChangeHandler=null),this.widget.content.activeCellIndex!==this._currentProviderIndex&&(this._delayedActiveCellChangeHandler=setTimeout((()=>{this.delayedActiveCellChangeHandlerReady=this._handleHighlightsAfterActiveCellChange()}),0)),this._observeActiveCell()}async _handleHighlightsAfterActiveCellChange(){if(this._onSelection){const e=null!==this._currentProviderIndex&&this._currentProviderIndex<this.widget.content.widgets.length?this.widget.content.widgets[this._currentProviderIndex]:null;e&&this.widget.content.isSelectedOrActive(e)||(await this._updateCellSelection(),await this.clearHighlight(),this._currentProviderIndex=this.widget.content.activeCellIndex)}await this._ensureCurrentMatch()}async _ensureCurrentMatch(){if(null!==this._currentProviderIndex){const e=this._searchProviders[this._currentProviderIndex];if(!e)return;!e.getCurrentMatch()&&this.matchesCount&&await this.highlightNext(!0,{from:"start",scroll:!1,select:!1})}}_observeActiveCell(){var e;const t=null===(e=this.widget.content.activeCell)||void 0===e?void 0:e.editor;t&&(this._stopObservingLastCell(),t.model.selections.changed.connect(this._setSelectedLines,this),this._editorSelectionsObservable=t.model.selections)}_stopObservingLastCell(){this._editorSelectionsObservable&&this._editorSelectionsObservable.changed.disconnect(this._setSelectedLines,this)}_setSelectedLines(){var e;const t=null===(e=this.widget.content.activeCell)||void 0===e?void 0:e.editor;if(!t)return;const n=t.getSelection(),{start:i,end:s}=n,o=s.line===i.line&&s.column===i.column?0:s.line-i.line+1;this._textSelection=n,o!==this._selectedLines&&(this._selectedLines=o,this._updateSelectionMode()),this._filtersChanged.emit()}async _setEnginesSelectionSearchMode(){let e;e=!!this._onSelection&&"text"===this._selectionSearchMode,this._selectionLock||await Promise.all(this._searchProviders.map(((t,n)=>{const i=this.widget.content.activeCellIndex===n;return t.setProtectSelection(i&&this._onSelection),t.setSearchSelection(i&&e?this._textSelection:null)})))}async _onCellSelectionChanged(){if(null!==this._delayedActiveCellChangeHandler&&(clearTimeout(this._delayedActiveCellChangeHandler),this._delayedActiveCellChangeHandler=null),await this._updateCellSelection(),null===this._currentProviderIndex){const e=this.widget.content.widgets.findIndex((e=>this.widget.content.isSelectedOrActive(e)));this._currentProviderIndex=e}await this._ensureCurrentMatch()}async _updateCellSelection(){const e=this.widget.content.widgets;let t=0;await Promise.all(e.map((async(e,n)=>{const i=this._searchProviders[n],s=this.widget.content.isSelectedOrActive(e);s&&(t+=1),i&&this._onSelection&&await i.setIsActive(s)}))),t!==this._selectedCells&&(this._selectedCells=t,this._updateSelectionMode()),this._filtersChanged.emit()}}var ct,ut=n(95459),gt=n(17262);!function(e){e[e.Idle=-1]="Idle",e[e.Scheduled=0]="Scheduled",e[e.Running=1]="Running"}(ct||(ct={}));class pt extends ut.U{constructor(e,t,n,i){super(e,i),this.parser=t,this.sanitizer=n,this.configMetadataMap={numberHeaders:["toc-autonumbering","toc/number_sections"],numberingH1:["!toc/skip_h1_title"],baseNumbering:["toc/base_numbering"]},this._runningCells=new Array,this._cellToHeadingIndex=new WeakMap,e.context.ready.then((()=>{this.setConfiguration({})})),this.widget.context.model.metadataChanged.connect(this.onMetadataChanged,this),this.widget.content.activeCellChanged.connect(this.onActiveCellChanged,this),de.executionScheduled.connect(this.onExecutionScheduled,this),de.executed.connect(this.onExecuted,this),this.headingsChanged.connect(this.onHeadingsChanged,this)}get documentType(){return"notebook"}get isAlwaysActive(){return!0}get supportedOptions(){return["baseNumbering","maximalDepth","numberingH1","numberHeaders","includeOutput","syncCollapseState"]}getCellHeadings(e){const t=new Array;let n=this._cellToHeadingIndex.get(e);if(void 0!==n){const e=this.headings[n];for(t.push(e);this.headings[n-1]&&this.headings[n-1].cellRef===e.cellRef;)n--,t.unshift(this.headings[n])}return t}dispose(){var e,t,n;this.isDisposed||(this.headingsChanged.disconnect(this.onHeadingsChanged,this),null===(t=null===(e=this.widget.context)||void 0===e?void 0:e.model)||void 0===t||t.metadataChanged.disconnect(this.onMetadataChanged,this),null===(n=this.widget.content)||void 0===n||n.activeCellChanged.disconnect(this.onActiveCellChanged,this),de.executionScheduled.disconnect(this.onExecutionScheduled,this),de.executed.disconnect(this.onExecuted,this),this._runningCells.length=0,super.dispose())}setConfiguration(e){const t=this.loadConfigurationFromMetadata();super.setConfiguration({...this.configuration,...t,...e})}toggleCollapse(e){super.toggleCollapse(e),this.updateRunningStatus(this.headings)}getHeadings(){const e=this.widget.content.widgets,t=[],n=new Array;for(let i=0;i<e.length;i++){const s=e[i];switch(s.model.type){case"code":!this.configuration.syncCollapseState&&this.configuration.includeOutput&&t.push(...b.tF(s.headings,this.configuration,n).map((e=>({...e,cellRef:s,collapsed:!1,isRunning:ct.Idle}))));break;case"markdown":{const e=b.tF(s.headings,this.configuration,n).map(((e,t)=>({...e,cellRef:s,collapsed:!1,isRunning:ct.Idle})));if(this.configuration.syncCollapseState&&s.headingCollapsed){const t=Math.min(...e.map((e=>e.level)));e.find((e=>e.level===t)).collapsed=s.headingCollapsed}t.push(...e);break}}t.length>0&&this._cellToHeadingIndex.set(s,t.length-1)}return this.updateRunningStatus(t),Promise.resolve(t)}loadConfigurationFromMetadata(){const e=this.widget.content.model,t={};if(e)for(const n in this.configMetadataMap){const i=this.configMetadataMap[n];for(const s of i){let i=s;const o="!"===i[0];o&&(i=i.slice(1));const a=i.split("/");let l=e.getMetadata(a[0]);for(let e=1;e<a.length;e++)l=(null!=l?l:{})[a[e]];void 0!==l&&("boolean"==typeof l&&o&&(l=!l),t[n]=l)}}return t}onActiveCellChanged(e,t){const n=this.getCellHeadings(t)[0];this.setActiveHeading(null!=n?n:null,!1)}onHeadingsChanged(){this.widget.content.activeCell&&this.onActiveCellChanged(this.widget.content,this.widget.content.activeCell)}onExecuted(e,t){this._runningCells.forEach(((e,n)=>{if(e===t.cell){this._runningCells.splice(n,1);const t=this._cellToHeadingIndex.get(e);void 0!==t&&(this.headings[t].isRunning=ct.Idle)}})),this.updateRunningStatus(this.headings),this.stateChanged.emit()}onExecutionScheduled(e,t){this._runningCells.includes(t.cell)||this._runningCells.push(t.cell),this.updateRunningStatus(this.headings),this.stateChanged.emit()}onMetadataChanged(){this.setConfiguration({})}updateRunningStatus(e){this._runningCells.forEach(((e,t)=>{const n=this._cellToHeadingIndex.get(e);if(void 0!==n){const e=this.headings[n];e.isRunning=Math.max(t>0?ct.Scheduled:ct.Running,e.isRunning)}}));let t=0;for(;t<e.length;){const i=e[t];if(t++,i.collapsed){const t=Math.max(i.isRunning,n(e,i.level));i.dataset={...i.dataset,"data-running":t.toString()}}else i.dataset={...i.dataset,"data-running":i.isRunning.toString()}}function n(e,i){let s=ct.Idle;for(;t<e.length;){const o=e[t];if(o.dataset={...o.dataset,"data-running":o.isRunning.toString()},!(o.level>i))break;t++,s=Math.max(o.isRunning,s),o.collapsed&&(s=Math.max(s,n(e,o.level)),o.dataset={...o.dataset,"data-running":s.toString()})}return s}}}class mt extends gt.w{constructor(e,t,n){super(e),this.parser=t,this.sanitizer=n}_createNew(e,t){const n=new pt(e,this.parser,this.sanitizer,t);let i=new WeakMap;const s=(t,n)=>{if(n){const t=t=>{if(!t.inViewport)return;const s=i.get(n);if(s){const t=e.content.node.getBoundingClientRect(),n=s.getBoundingClientRect();(n.top>t.bottom||n.bottom<t.top)&&s.scrollIntoView({block:"center"})}},s=n.cellRef,o=e.content.widgets.indexOf(s);e.content.activeCellIndex=o,s.inViewport?t(s):e.content.scrollToItem(o).then((()=>{t(s)})).catch((e=>{console.error("Fail to scroll to cell to display the required heading.")}))}},o=e=>{n.getCellHeadings(e).forEach((async e=>{var t,n;const s=await Ct(e,this.parser),o=s?`h${e.level}[id="${s}"]`:`h${e.level}`;void 0!==e.outputIndex?i.set(e,b.U9(e.cellRef.outputArea.widgets[e.outputIndex].node,o,null!==(t=e.prefix)&&void 0!==t?t:"")):i.set(e,b.U9(e.cellRef.node,o,null!==(n=e.prefix)&&void 0!==n?n:""))}))},a=t=>{this.parser&&(b.Zd(e.content.node),i=new WeakMap,e.content.widgets.forEach((e=>{o(e)})))},l=(t,i)=>{var s,o,a,l;if(n.configuration.syncCollapseState)if(null!==i){const e=i.cellRef;e.headingCollapsed!==(null!==(s=i.collapsed)&&void 0!==s&&s)&&(e.headingCollapsed=null!==(o=i.collapsed)&&void 0!==o&&o)}else{const t=null!==(l=null===(a=n.headings[0])||void 0===a?void 0:a.collapsed)&&void 0!==l&&l;e.content.widgets.forEach((e=>{e instanceof se&&e.headingInfo.level>=0&&(e.headingCollapsed=t)}))}},d=(e,t)=>{if(n.configuration.syncCollapseState){const e=n.getCellHeadings(t)[0];e&&n.toggleCollapse({heading:e,collapsed:t.headingCollapsed})}},r=(e,t)=>{t.inViewport?o(t):b.Zd(t.node)};return e.context.ready.then((()=>{a(),n.activeHeadingChanged.connect(s),n.headingsChanged.connect(a),n.collapseChanged.connect(l),e.content.cellCollapsed.connect(d),e.content.cellInViewportChanged.connect(r),e.disposed.connect((()=>{n.activeHeadingChanged.disconnect(s),n.headingsChanged.disconnect(a),n.collapseChanged.disconnect(l),e.content.cellCollapsed.disconnect(d),e.content.cellInViewportChanged.disconnect(r)}))})),n}}async function Ct(e,t){let n=null;return e.type===ee.HeadingType.Markdown?n=await y.N4(t,e.raw,e.level):e.type===ee.HeadingType.HTML&&(n=e.id),n}const _t=new S.Token("@jupyterlab/notebook:INotebookWidgetFactory","A service to create the notebook viewer."),vt=new S.Token("@jupyterlab/notebook:INotebookTools",'A service for the "Notebook Tools" panel in the\n  right sidebar. Use this to add your own functionality to the panel.'),ft=new S.Token("@jupyterlab/notebook:INotebookTracker","A widget tracker for notebooks.\n  Use this if you want to be able to iterate over and interact with notebooks\n  created by the application.");class wt extends i.WidgetTracker{constructor(){super(...arguments),this._activeCell=null,this._activeCellChanged=new s.Signal(this),this._selectionChanged=new s.Signal(this)}get activeCell(){const e=this.currentWidget;return e&&e.content.activeCell||null}get activeCellChanged(){return this._activeCellChanged}get selectionChanged(){return this._selectionChanged}add(e){const t=super.add(e);return e.content.activeCellChanged.connect(this._onActiveCellChanged,this),e.content.selectionChanged.connect(this._onSelectionChanged,this),t}dispose(){this._activeCell=null,super.dispose()}onCurrentChanged(e){const t=this.activeCell;t&&t===this._activeCell||(this._activeCell=t,e&&this._activeCellChanged.emit(e.content.activeCell||null))}_onActiveCellChanged(e,t){this.currentWidget&&this.currentWidget.content===e&&(this._activeCell=t||null,this._activeCellChanged.emit(this._activeCell))}_onSelectionChanged(e){this.currentWidget&&this.currentWidget.content===e&&this._selectionChanged.emit(void 0)}}function yt(e){return e.allCellsTrusted?D().createElement(k.trustedIcon.react,{top:"2px",stylesheet:"statusBar"}):D().createElement(k.notTrustedIcon.react,{top:"2px",stylesheet:"statusBar"})}class bt extends k.VDomRenderer{constructor(e){super(new bt.Model),this.translator=e||x.nullTranslator,this.node.classList.add("jp-StatusItem-trust")}render(){if(!this.model)return null;const e=function(e,t){const n=(t=t||x.nullTranslator).load("jupyterlab");return e.trustedCells===e.totalCells?n.__("Notebook trusted: %1 of %2 code cells trusted.",e.trustedCells,e.totalCells):e.activeCellTrusted?n.__("Active cell trusted: %1 of %2 code cells trusted.",e.trustedCells,e.totalCells):n.__("Notebook not trusted: %1 of %2 code cells trusted.",e.trustedCells,e.totalCells)}(this.model,this.translator);return e!==this.node.title&&(this.node.title=e),D().createElement(yt,{allCellsTrusted:this.model.trustedCells===this.model.totalCells,activeCellTrusted:this.model.activeCellTrusted,totalCells:this.model.totalCells,trustedCells:this.model.trustedCells})}}!function(e){class t extends k.VDomModel{constructor(){super(...arguments),this._trustedCells=0,this._totalCells=0,this._activeCellTrusted=!1,this._notebook=null}get trustedCells(){return this._trustedCells}get totalCells(){return this._totalCells}get activeCellTrusted(){return this._activeCellTrusted}get notebook(){return this._notebook}set notebook(e){const t=this._notebook;null!==t&&(t.activeCellChanged.disconnect(this._onActiveCellChanged,this),t.modelContentChanged.disconnect(this._onModelChanged,this));const n=this._getAllState();if(this._notebook=e,null===this._notebook)this._trustedCells=0,this._totalCells=0,this._activeCellTrusted=!1;else{this._notebook.activeCellChanged.connect(this._onActiveCellChanged,this),this._notebook.modelContentChanged.connect(this._onModelChanged,this),this._notebook.activeCell?this._activeCellTrusted=this._notebook.activeCell.model.trusted:this._activeCellTrusted=!1;const{total:e,trusted:t}=this._deriveCellTrustState(this._notebook.model);this._totalCells=e,this._trustedCells=t}this._triggerChange(n,this._getAllState())}_onModelChanged(e){const t=this._getAllState(),{total:n,trusted:i}=this._deriveCellTrustState(e.model);this._totalCells=n,this._trustedCells=i,this._triggerChange(t,this._getAllState())}_onActiveCellChanged(e,t){const n=this._getAllState();this._activeCellTrusted=!!t&&t.model.trusted,this._triggerChange(n,this._getAllState())}_deriveCellTrustState(e){if(null===e)return{total:0,trusted:0};let t=0,n=0;for(const i of e.cells)"code"===i.type&&(t++,i.trusted&&n++);return{total:t,trusted:n}}_getAllState(){return[this._trustedCells,this._totalCells,this.activeCellTrusted]}_triggerChange(e,t){e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]||this.stateChanged.emit(void 0)}}e.Model=t}(bt||(bt={}));class xt extends Ne.ABCWidgetFactory{constructor(e){super(e),this.rendermime=e.rendermime,this.contentFactory=e.contentFactory,this.mimeTypeService=e.mimeTypeService,this._editorConfig=e.editorConfig||Ze.defaultEditorConfig,this._notebookConfig=e.notebookConfig||Ze.defaultNotebookConfig}get editorConfig(){return this._editorConfig}set editorConfig(e){this._editorConfig=e}get notebookConfig(){return this._notebookConfig}set notebookConfig(e){this._notebookConfig=e}createNewWidget(e,t){const n=e.translator,i={rendermime:t?t.content.rendermime:this.rendermime.clone({resolver:e.urlResolver}),contentFactory:this.contentFactory,mimeTypeService:this.mimeTypeService,editorConfig:t?t.content.editorConfig:this._editorConfig,notebookConfig:t?t.content.notebookConfig:this._notebookConfig,translator:n},s=this.contentFactory.createNotebook(i);return new nt({context:e,content:s})}}},82361:(e,t,n)=>{n.r(t),n.d(t,{Debouncer:()=>d,Poll:()=>a,RateLimiter:()=>l,Throttler:()=>r});var i,s=n(50558),o=n(53968);class a{constructor(e){var t;this._disposed=new o.Signal(this),this._lingered=0,this._tick=new s.PromiseDelegate,this._ticked=new o.Signal(this),this._factory=e.factory,this._linger=null!==(t=e.linger)&&void 0!==t?t:i.DEFAULT_LINGER,this._standby=e.standby||i.DEFAULT_STANDBY,this._state={...i.DEFAULT_STATE,timestamp:(new Date).getTime()};const n=e.frequency||{},a=Math.max(n.interval||0,n.max||0,i.DEFAULT_FREQUENCY.max);this.frequency={...i.DEFAULT_FREQUENCY,...n,max:a},this.name=e.name||i.DEFAULT_NAME,"auto"in e&&!e.auto||setTimeout((()=>this.start()))}get disposed(){return this._disposed}get frequency(){return this._frequency}set frequency(e){if(this.isDisposed||s.JSONExt.deepEqual(e,this.frequency||{}))return;let{backoff:t,interval:n,max:i}=e;if(n=Math.round(n),i=Math.round(i),"number"==typeof t&&t<1)throw new Error("Poll backoff growth factor must be at least 1");if((n<0||n>i)&&n!==a.NEVER)throw new Error("Poll interval must be between 0 and max");if(i>a.MAX_INTERVAL&&i!==a.NEVER)throw new Error(`Max interval must be less than ${a.MAX_INTERVAL}`);this._frequency={backoff:t,interval:n,max:i}}get isDisposed(){return"disposed"===this.state.phase}get standby(){return this._standby}set standby(e){this.isDisposed||this.standby===e||(this._standby=e)}get state(){return this._state}get tick(){return this._tick.promise}get ticked(){return this._ticked}async*[Symbol.asyncIterator](){for(;!this.isDisposed;)yield this.state,await this.tick.catch((()=>{}))}dispose(){this.isDisposed||(this._state={...i.DISPOSED_STATE,timestamp:(new Date).getTime()},this._tick.promise.catch((e=>{})),this._tick.reject(new Error(`Poll (${this.name}) is disposed.`)),this._disposed.emit(void 0),o.Signal.clearData(this))}refresh(){return this.schedule({cancel:({phase:e})=>"refreshed"===e,interval:a.IMMEDIATE,phase:"refreshed"})}async schedule(e={}){if(this.isDisposed)return;if(e.cancel&&e.cancel(this.state))return;const t=this._tick,n=new s.PromiseDelegate,i={interval:this.frequency.interval,payload:null,phase:"standby",timestamp:(new Date).getTime(),...e};this._state=i,this._tick=n,clearTimeout(this._timeout),this._ticked.emit(this.state),t.resolve(this),await t.promise,i.interval!==a.NEVER?this._timeout=setTimeout((()=>{this.isDisposed||this.tick!==n.promise||this._execute()}),i.interval):this._timeout=void 0}start(){return this.schedule({cancel:({phase:e})=>"constructed"!==e&&"standby"!==e&&"stopped"!==e,interval:a.IMMEDIATE,phase:"started"})}stop(){return this.schedule({cancel:({phase:e})=>"stopped"===e,interval:a.NEVER,phase:"stopped"})}get hidden(){return i.hidden}_execute(){let e="function"==typeof this.standby?this.standby():this.standby;if("never"===e?e=!1:"when-hidden"===e&&(this.hidden?e=++this._lingered>this._linger:(this._lingered=0,e=!1)),e)return void this.schedule();const t=this.tick;this._factory(this.state).then((e=>{this.isDisposed||this.tick!==t||this.schedule({payload:e,phase:"rejected"===this.state.phase?"reconnected":"resolved"})})).catch((e=>{this.isDisposed||this.tick!==t||this.schedule({interval:i.sleep(this.frequency,this.state),payload:e,phase:"rejected"})}))}}!function(e){e.IMMEDIATE=0,e.MAX_INTERVAL=2147483647,e.NEVER=1/0}(a||(a={})),function(e){e.DEFAULT_BACKOFF=3,e.DEFAULT_FREQUENCY={backoff:!0,interval:1e3,max:3e4},e.DEFAULT_LINGER=1,e.DEFAULT_NAME="unknown",e.DEFAULT_STANDBY="when-hidden",e.DEFAULT_STATE={interval:a.NEVER,payload:null,phase:"constructed",timestamp:new Date(0).getTime()},e.DISPOSED_STATE={interval:a.NEVER,payload:null,phase:"disposed",timestamp:new Date(0).getTime()},e.sleep=function(t,n){const{backoff:i,interval:s,max:o}=t;if(s===a.NEVER)return s;const l=!0===i?e.DEFAULT_BACKOFF:!1===i?1:i,d=function(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}(s,n.interval*l);return Math.min(o,d)},e.hidden="undefined"!=typeof document&&(document.addEventListener("visibilitychange",(()=>{e.hidden="hidden"===document.visibilityState})),document.addEventListener("pagehide",(()=>{e.hidden="hidden"===document.visibilityState})),"hidden"===document.visibilityState)}(i||(i={}));class l{constructor(e,t=500){this.args=void 0,this.payload=null,this.limit=t,this.poll=new a({auto:!1,factory:async()=>{const{args:t}=this;return this.args=void 0,e(...t)},frequency:{backoff:!1,interval:a.NEVER,max:a.NEVER},standby:"never"}),this.payload=new s.PromiseDelegate,this.poll.ticked.connect(((e,t)=>{const{payload:n}=this;return"resolved"===t.phase?(this.payload=new s.PromiseDelegate,void n.resolve(t.payload)):"rejected"===t.phase||"stopped"===t.phase?(this.payload=new s.PromiseDelegate,n.promise.catch((e=>{})),void n.reject(t.payload)):void 0}),this)}get isDisposed(){return null===this.payload}dispose(){this.isDisposed||(this.args=void 0,this.payload=null,this.poll.dispose())}async stop(){return this.poll.stop()}}class d extends l{invoke(...e){return this.args=e,this.poll.schedule({interval:this.limit,phase:"invoked"}),this.payload.promise}}class r extends l{constructor(e,t){super(e,"number"==typeof t?t:t&&t.limit),this._trailing=!1,"number"!=typeof t&&t&&"trailing"===t.edge&&(this._trailing=!0),this._interval=this._trailing?this.limit:a.IMMEDIATE}invoke(...e){const t="invoked"!==this.poll.state.phase;return(t||this._trailing)&&(this.args=e),t&&this.poll.schedule({interval:this._interval,phase:"invoked"}),this.payload.promise}}}}]);